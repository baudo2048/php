<html><head></head><body>
<script id="ux-boot-script">
var store = {};
window.addEventListener('DOMContentLoaded', (event) => {
    
    document.db = JSON.parse(document.getElementById('ux-local-store').textContent);
    document.db.Project[0].Component.forEach( (v,i) => {
        
        var jsFunc = ux.parserJSFunction(v.name,v.ux,v.js,v.css);

        var script = document.createElement('script')
        script.setAttribute('id',v.name) 
        script.append(document.createTextNode(jsFunc))
        document.body.append(script)
    });
    
    document.head.appendChild(head());
    window.onload = () => {
        document.body.appendChild(body());
        //document.db = JSON.parse(document.getElementById('ux-local-store').innerHTML);
        //document.getElementById('ux-local-store').innerHTML = JSON.stringify(store);
    }
});
</script>
<div id="ux-content-md" style="display:none">
</div>
<div id="ux-local-store" style="display:none">
{
"Project": [{
    "name": "index",
    "url": "index",
    "Component": [
    {
      "name": "app",
      "text": "",
      "ux": "div root\n    -display flex\n    -flexDirection column\n    -height 100%\n    -alignContent center\n    -background rgb(2,0,36)\n    -background radial-gradient(circle, rgba(2,0,36,1) 0%, rgba(9,9,121,1) 35%, rgba(0,212,255,1) 100%)\n \n    *db\n\n    div\n        -display flex\n        -flexGrow 1\n\n        div content\n            -display flex\n            -overflow none\n            -flexGrow 1\n            -backgroundColor #f3f3f3\n\n            *windowDev w2\n            \n    \n\n            -display none\n\n    *toast\n        *viewProjects\n    *viewComponents\n",
      "js": "\n\n//helpComp.style.display = 'none'\nw2.style.display = 'flex'\n//hlp.style.display = 'none'\n\n\ndocument.register('app.showHelp', ev=> {\n    //hlp.style.display = 'flex'\n    w2.style.display = 'none'\n})\n\ndocument.register('app.showEditor', ev=> {\n    //hlp.style.display = 'none'\n    w2.style.display = 'flex'\n})\n\n\n//document.em(\"db.start\")",
      "css": ""
    },
    {
      "name": "windowDev",
      "text": "",
      "ux": "div root\n    -display flex\n    -flexBasis 100%\n    -width 100%\n    -height 100%\n    -flexDirection column\n    -border 3px solid black\n    -overflow none\n    -boxSizing border-box\n    \n    div topBar\n        .class topBar\n        -display flex\n        -justifyContent space-between\n        -alignItems center\n\n        \n        div \n            -marginLeft 50px\n            -display flex\n            -gap 1rem\n            -alignItems center  \n\n            span ctaFile 'File\n                .class menu\n                *menuFile mnuFile\n            \n            span ctaTools 'Tools\n                .class menu\n                \n            span ctaProject 'Project\n                .class menu\n                *menuProject mnuProject\n\n            span ctaData 'Data\n                .class menu\n                *menuData mnuData\n\n            span ctaLearn 'Learn\n                .class menu\n                *menuLearn mnuLearn\n\n            span imgCode '{html}\n                -display none\n                .class menu\n\n            span imgScript '{js}\n                -display none\n                .class menu\n\n            span imgCss '{css}\n                -display none\n                .class menu\n\n            span imgPreview 'Preview\n                -display none\n                .class menu\n\n            span 'more_vert  \n                .class material-icons\n                -color white\n\n            span newPreview 'preview\n                .class material-icons\n                -color white \n\n            \n        \n        div\n            -display flex\n            -flexGrow 1\n            input fileName\n                -visibility hidden\n                -width 100%\n                -height 30px\n                -marginLeft 10px\n                -marginRight 10px\n                -fontSize large\n                .type text\n                .value\n                .class fileName\n      \n        \n\n\n\n        span windowImgMaximize 'maximize\n            -color white\n            -cursor pointer\n            .class material-icons\n\n\n    \n    div contentArea\n        -display flex\n        -display none\n        -flexGrow 1\n        -overflow auto\n        -backgroundColor white\n        \n    div codeArea\n        -display flex\n        -flexGrow 1\n\n        textarea textareaText\n            -resize none\n            -width 100%\n            -height 100%\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor black\n            -color white\n            -display none\n\n        textarea textareaCode \n            -resize none\n            -width 100%\n            -height 100%\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor black\n            -color white\n            \n\n        textarea textareaScript\n            -resize none\n            -width 100%\n            -height 100%\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor black\n            -color white   \n            -display none\n\n        textarea textareaCss\n            -resize none\n            -width 100%\n            -height 100%\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor black\n            -color white   \n            -display none\n\n        textarea textareaNode\n            -resize none\n            -width 100%\n            -height 100%\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor black\n            -color white   \n            -display none\n\n    div resizer\n        -display none\n        -position absolute\n        -width 3px\n        -height 3px\n        -borderRadius 50%\n        -border 3px solid #4286f4\n        -right -5px\n        -bottom -5px\n        -cursor nwse-resize\n\n",
      "js": "// LOCAL VARIABLES USED AS STATE VARIABLES\n//var countPreview = 0\n\ntextareaText.onkeydown = ev => {\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaText.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaText.value.substr(0, caretPos)\n        const strLen = textareaText.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaText.value = textareaText.value.substr(0, caretPos) + \"    \" + textareaText.value.substr(caretPos, strSecondLen)\n        textareaText.selectionEnd = caretPos + 4\n    } \n}\n\ntextareaCode.onkeydown = ev => {\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaCode.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaCode.value.substr(0, caretPos)\n        const strLen = textareaCode.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaCode.value = textareaCode.value.substr(0, caretPos) + \"    \" + textareaCode.value.substr(caretPos, strSecondLen)\n        textareaCode.selectionEnd = caretPos + 4\n    } \n}\n\ntextareaScript.onkeydown = ev => {\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaScript.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaScript.value.substr(0, caretPos)\n        const strLen = textareaScript.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaScript.value = textareaScript.value.substr(0, caretPos) + \"    \" + textareaScript.value.substr(caretPos, strSecondLen)\n        textareaScript.selectionEnd = caretPos + 4\n    } \n}\n\ntextareaCss.onkeydown = ev => {\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaCss.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaCss.value.substr(0, caretPos)\n        const strLen = textareaCss.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaCss.value = textareaCss.value.substr(0, caretPos) + \"    \" + textareaCss.value.substr(caretPos, strSecondLen)\n        textareaCss.selectionEnd = caretPos + 4\n    } \n\n    if(ev.keyCode == 17) {\n        ev.preventDefault()\n        // A panel appear\n        // leggo la riga dove si trova il cursore etc.\n    }\n}\n\ntextareaNode.onkeydown = ev => {\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaNode.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaNode.value.substr(0, caretPos)\n        const strLen = textareaNode.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaNode.value = textareaNode.value.substr(0, caretPos) + \"    \" + textareaNode.value.substr(caretPos, strSecondLen)\n        textareaNode.selectionEnd = caretPos + 4\n    } \n}\n\nmnuFile.style.display = 'none'\nctaFile.onclick = ev => {\n    var rect = ctaFile.getBoundingClientRect()\n    mnuFile.style.display = 'initial'\n    mnuFile.style.position = 'fixed'\n    mnuFile.style.top = rect.bottom +'px'\n    mnuFile.style.left = rect.left + 'px'\n    mnuFile.style.padding = '10px'\n}\n\n// *********** mnuFile\nvar isMouseOver = false\n\nmnuFile.style.display = 'none'\nctaFile.onclick = ev => {\n    var rect = ctaFile.getBoundingClientRect()\n    mnuFile.style.display = 'initial'\n    mnuFile.style.position = 'fixed'\n    mnuFile.style.top = rect.bottom +'px'\n    mnuFile.style.left = rect.left + 'px'\n    mnuFile.style.padding = '10px'\n}\n\nctaFile.onmouseover = ev => {\n    ctaFile.style.background = 'rgb(35,38,39)'\n    ctaFile.style.background = 'radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%)'\n}\n\nctaFile.onmouseleave = ev => {\n    ctaFile.style.background = 'initial'\n\n    if(!isMouseOver) mnuFile.style.display = 'none'\n}\n\nmnuFile.onmouseover = ev => {\n    isMouseOver = true\n}\n\nmnuFile.onmouseleave = ev => {\n    isMouseOver = false\n}\n// *************************************************\n\n\n// *********** mnuTools\n//mnuTools.style.display = 'none'\nctaTools.onclick = ev => {\n    var rect = ctaTools.getBoundingClientRect()\n    //mnuTools.style.display = 'initial'\n    //mnuTools.style.position = 'fixed'\n    //mnuTools.style.top = rect.bottom +'px'\n    //mnuTools.style.left = rect.left + 'px'\n    //mnuTools.style.padding = '10px'\n}\n\nctaTools.onmouseover = ev => {\n    ctaTools.style.background = 'rgb(35,38,39)'\n    ctaTools.style.background = 'radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%)'\n}\n\nctaTools.onmouseleave = ev => {\n    ctaTools.style.background = 'initial'\n\n    //if(!isMouseOver) //mnuTools.style.display = 'none'\n}\n\n// *********** mnuProject\nmnuProject.style.display = 'none'\nctaProject.onclick = ev => {\n    var rect = ctaProject.getBoundingClientRect()\n    mnuProject.style.display = 'initial'\n    mnuProject.style.position = 'fixed'\n    mnuProject.style.top = rect.bottom +'px'\n    mnuProject.style.left = rect.left + 'px'\n    mnuProject.style.padding = '10px'\n}\n\nctaProject.onmouseleave = ev => {\n    ctaProject.style.background = 'initial'\n\n    if(!isMouseOver) mnuProject.style.display = 'none'\n}\n\n\n// *********** mnuData\nmnuData.style.display = 'none'\nctaData.onclick = ev => {\n    var rect = ctaData.getBoundingClientRect()\n    mnuData.style.display = 'initial'\n    mnuData.style.position = 'fixed'\n    mnuData.style.top = rect.bottom +'px'\n    mnuData.style.left = rect.left + 'px'\n    mnuData.style.padding = '10px'\n}\n\n//ctaLearn.onmouseover = ev => {\n//    ctaLearn.style.background = 'rgb(35,38,39)'\n//    ctaLearn.style.background = 'radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%)'\n//}\n\nctaData.onmouseleave = ev => {\n    ctaData.style.background = 'initial'\n\n    if(!isMouseOver) mnuData.style.display = 'none'\n}\n\n\n// *********** mnuLearn\nmnuLearn.style.display = 'none'\nctaLearn.onclick = ev => {\n    var rect = ctaLearn.getBoundingClientRect()\n    mnuLearn.style.display = 'initial'\n    mnuLearn.style.position = 'fixed'\n    mnuLearn.style.top = rect.bottom +'px'\n    mnuLearn.style.left = rect.left + 'px'\n    mnuLearn.style.padding = '10px'\n}\n\nctaLearn.onmouseover = ev => {\n    ctaLearn.style.background = 'rgb(35,38,39)'\n    ctaLearn.style.background = 'radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%)'\n}\n\nctaLearn.onmouseleave = ev => {\n    ctaLearn.style.background = 'initial'\n\n    if(!isMouseOver) mnuLearn.style.display = 'none'\n}\n\n\n\n// *************************************\n\nwindowImgMaximize.onclick = ev => {\n    root.style.left = '0px';\n    root.style.top = '0px';\n    root.style.width = document.body.clientWidth + 'px';\n    root.style.height = document.body.clientHeight + 'px';\n}\n\nimgCode.onclick = ev => {\n    codeArea.style.display = 'flex'\n    textareaCode.style.display = 'block'\n    textareaText.style.display = 'none'\n    textareaScript.style.display = 'none'\n    textareaCss.style.display = 'none'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaCode.focus()\n}\n\ndocument.register(\"windowDev.showCode\", ev => {\n    codeArea.style.display = 'flex'\n    textareaCode.style.display = 'block'\n    textareaText.style.display = 'none'\n    textareaScript.style.display = 'none'\n    textareaCss.style.display = 'none'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaCode.focus()\n})\n\nimgScript.onclick = ev => {\n    codeArea.style.display = 'flex'\n    textareaText.style.display = 'none'\n    textareaCode.style.display = 'none'\n    textareaScript.style.display = 'block'\n    textareaCss.style.display = 'none'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaScript.focus()\n}\n\ndocument.register(\"windowDev.showScript\", ev => {\n    codeArea.style.display = 'flex'\n    textareaText.style.display = 'none'\n    textareaCode.style.display = 'none'\n    textareaScript.style.display = 'block'\n    textareaCss.style.display = 'none'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaScript.focus()\n})\n\nimgCss.onclick = ev => {\n    codeArea.style.display = 'flex'\n    textareaText.style.display = 'none'\n    textareaCode.style.display = 'none'\n    textareaScript.style.display = 'none'\n    textareaCss.style.display = 'block'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaCss.focus()\n}\n\ndocument.register(\"windowDev.showCss\", ev => { \n    codeArea.style.display = 'flex'\n    textareaText.style.display = 'none'\n    textareaCode.style.display = 'none'\n    textareaScript.style.display = 'none'\n    textareaCss.style.display = 'block'\n    contentArea.style.display = 'none'\n    textareaNode.style.display = 'none'\n\n    textareaCss.focus()\n})\n\nvar count = 0\nimgPreview.onclick = ev => {\n\n    // SAVE ON LOCAL DB - SAVE FIRST !\n    var cp = document.UI.currentProjectID;\n    var cc = document.UI.currentComponentID;\n    var comp = document.db.Project[cp].Component[cc]\n\n    document.db.Project[cp].Component[cc].name = fileName.value\n    document.db.Project[cp].Component[cc].text = textareaText.value\n    document.db.Project[cp].Component[cc].ux = textareaCode.value\n    document.db.Project[cp].Component[cc].js = textareaScript.value\n    document.db.Project[cp].Component[cc].css = textareaCss.value\n\n    // I should remove the previous function\n\n    //count++\n    codeArea.style.display = 'none'\n    \n    // var code =document.parser('functionName', textareaCode.value, textareaScript.value, textareaCss.value)\n    var code = ux.parserJSFunction(comp.name,comp.ux, comp.js, comp.css)\n\n    // TODO - QUI DEVO TENERE CONTO DI functionName ed eventualmente eliminare le funzioni\n    // gia definite. si possono eliminare gli effetti di una funzione?????\n    // SOLVEDE WITH A SIMPLE COUNTER\n    \n    var scriptTag = document.getElementById(comp.name)\n    if(scriptTag !== null){\n        scriptTag.parentNode.removeChild(scriptTag)\n    } \n\n    scriptTag = document.createElement('script')\n    scriptTag.setAttribute('id', comp.name)\n    scriptTag.append(document.createTextNode(code))\n    document.body.append(scriptTag)\n    \n\n    contentArea.style.display = 'flex'\n    contentArea.innerHTML = ''\n    //contentArea.append(window['functionName_'+count]())   // THIS IS THE TRICKY LINE\n    contentArea.append(window[comp.name]())\n    //contentArea.append(dom)\n\n    // TRANSACTION !!!\n    //document.json('newServiceGet',{projectId:0,code:textareaNode.value})\n    \n    //document.json('runServiceGet',{projectId:0,serviceId:0})\n    \n\n}\n\ndocument.register(\"windowDev.imgPreview\", ev => {\n\n    // SAVE ON LOCAL DB - SAVE FIRST !\n    var cp = document.UI.currentProjectID;\n    var cc = document.UI.currentComponentID;\n    var comp = document.db.Project[cp].Component[cc]\n\n    document.db.Project[cp].Component[cc].name = fileName.value\n    document.db.Project[cp].Component[cc].text = textareaText.value\n    document.db.Project[cp].Component[cc].ux = textareaCode.value\n    document.db.Project[cp].Component[cc].js = textareaScript.value\n    document.db.Project[cp].Component[cc].css = textareaCss.value\n\n    // I should remove the previous function\n\n    //count++\n    codeArea.style.display = 'none'\n    \n    // var code =document.parser('functionName', textareaCode.value, textareaScript.value, textareaCss.value)\n    var code = ux.parserJSFunction(comp.name,comp.ux, comp.js, comp.css)\n\n    // TODO - QUI DEVO TENERE CONTO DI functionName ed eventualmente eliminare le funzioni\n    // gia definite. si possono eliminare gli effetti di una funzione?????\n    // SOLVEDE WITH A SIMPLE COUNTER\n    \n    var scriptTag = document.getElementById(comp.name)\n    if(scriptTag !== null){\n        scriptTag.parentNode.removeChild(scriptTag)\n    } \n\n    scriptTag = document.createElement('script')\n    scriptTag.setAttribute('id', comp.name)\n    scriptTag.append(document.createTextNode(code))\n    document.body.append(scriptTag)\n    \n\n    contentArea.style.display = 'flex'\n    contentArea.innerHTML = ''\n    //contentArea.append(window['functionName_'+count]())   // THIS IS THE TRICKY LINE\n    contentArea.append(window[comp.name]())\n    //contentArea.append(dom)\n\n    // TRANSACTION !!!\n    //document.json('newServiceGet',{projectId:0,code:textareaNode.value})\n    \n    //document.json('runServiceGet',{projectId:0,serviceId:0})\n    \n\n})\n\nlet isDone = false\n\nnewPreview.onclick = ev => {\n    if(isDone) {\n        newPreview.textContent = 'preview'\n        document.em(\"tabber.closePreview\")\n        isDone = false\n    } else {\n        newPreview.textContent = 'done'\n        document.em(\"tabber.preview\")\n        isDone = true\n    }\n\n}\n\n/*\nfileName.onclick = ev => {\n    document.em('project.showPanel')\n    // show/hide project component\n    if(panelPrj.style.display == 'none'){\n        panelPrj.style.display = 'flex'\n        var rect = fileName.getBoundingClientRect();\n        panelPrj.left = rect.x + 'px';\n        panelPrj.top = rect.top+'px';\n    } else {\n        panelPrj.style.display = 'none'\n    }\n}\n*/\n\n\nfunction makeResizableDiv(div, resizer) {\n    const element = div;\n    const currentResizer = resizer;\n\n    currentResizer.addEventListener('mousedown', function(e) {\n        e.preventDefault();\n        document.body.addEventListener('mousemove', resize);\n        document.body.addEventListener('mouseup', stopResize);\n    });\n    \n    function resize(e) {\n        element.style.width = e.pageX - element.getBoundingClientRect().left + 'px';\n        element.style.height = e.pageY - element.getBoundingClientRect().top + 'px';\n    }\n    \n    function stopResize() {\n        document.body.removeEventListener('mousemove', resize);\n    }\n    \n}\n  \nmakeResizableDiv(root, resizer);\n\nfunction makeMovableDiv(div, resizer){\n\n    var prevX = 0;\n    var prevY = 0;\n    var initX = 0;\n    var initY = 0;\n\n    const element = div;\n    const currentResizer = resizer;\n\n    currentResizer.addEventListener('mousedown', function(e){\n        e.preventDefault();\n\n        prevX = e.clientX;\n        prevY = e.clientY;\n    \n        var rect = root.getBoundingClientRect();\n    \n        initX = rect.x;\n        initY = rect.y;\n\n        document.body.addEventListener('mousemove', move);\n        document.body.addEventListener('mouseup', stopMove);\n    });\n\n    function move(e) {\n        let newX = prevX - e.clientX;\n        let newY = prevY - e.clientY;\n\n        root.style.left = initX - newX +'px';\n        root.style.top = initY - newY +'px';\n    }\n    \n    function stopMove() {\n        document.body.removeEventListener('mousemove', move);\n    }\n}\n\n\n  \nroot.contentArea = contentArea\n\n// Preview\ndocument.register('windowDev.print', ev => {\n\n    codeArea.style.display = 'none'\n    \n\n    contentArea.style.display = 'flex'\n    contentArea.innerHTML = ''\n\n    contentArea.append(ev.detail)\n})\n\n// Preview Append Add\ndocument.register('windowDev.printAdd', ev => {\n\n    codeArea.style.display = 'none'\n    \n\n    contentArea.style.display = 'flex'\n\n    contentArea.append(ev.detail)\n})\n\ndocument.register('windowDev.textareaCode.append', ev => {\n    \n    var riga = ev.detail.varName + '.style.' + ev.detail.propertyName + ' = ' + \"'\" + ev.detail.propertyValue + \"'\"\n    textareaCss.value = textareaCss.value + '\\n' + riga\n})\n\n\ndocument.register('windowDev.loadComponent', ev => {\n    var cp = ev.detail.ProjectID\n    var cc = ev.detail.ComponentID\n\n    fileName.value = document.db.Project[cp].Component[cc].name\n    textareaCode.value = document.db.Project[cp].Component[cc].ux\n    textareaScript.value = document.db.Project[cp].Component[cc].js\n    textareaCss.value = document.db.Project[cp].Component[cc].css\n    textareaNode.value = document.db.Project[cp].Component[cc].node\n    textareaText.value = document.db.Project[cp].Component[cc].text\n\n    document.em(\"windowDev.loadComponentNext\", {ProjectID: cp, ComponentID: cc})\n})\n\nfunction disableWindowDev(){\n    fileName.disabled = true\n    textareaCode.disabled = true\n    textareaScript.disabled = true\n    textareaCss.disabled = true\n    textareaNode.disabled = true\n    textareaText.disabled = true\n}\n//disableWindowDev()\n\nfunction enableWindowDev(ev){\n    fileName.disabled = false\n    textareaCode.disabled = false\n    textareaScript.disabled = false\n    textareaCss.disabled = false\n    textareaNode.disabled = false\n    textareaText.disabled = false\n}\n\ndocument.register('windowDev.enable', enableWindowDev)\n\n\ndocument.register('windowDev.saveCurrentComponent', ev => {\n    \n    var cp = document.UI.currentProjectID\n    var cc = document.UI.currentComponentID\n    \n    store.Project[cp].Component[cc].fileName = fileName.value\n    store.Project[cp].Component[cc].ux = textareaCode.value\n    store.Project[cp].Component[cc].js = textareaScript.value\n    store.Project[cp].Component[cc].css = textareaCss.value\n    store.Project[cp].Component[cc].node = textareaNode.value\n})\n\n\ndocument.register('windowDev.textareaText', ev => {\n    document.em('windowDev.textareaText.value',{value: textareaText.value})\n})\n\ndocument.register('windowDev.textareaCode', ev => {\n    document.em('windowDev.textareaCode.value', {value: textareaCode.value})\n})\n\ndocument.register('windowDev.textareaCode.set', ev => {\n    textareaCode.value = ev.detail\n})\n\n\n\n// **********   SOCKET\n\n/*\n\n{\n    \"username\": 0,\n    \"projectId\": 0,\n    \"componentId\": 0,\n    \"passcode\": \"jckokhfehgimrn\" \n    \"componentUri\": \"windowDev.imgPreview.click\",\n    \"m\": \"windowDev.imgPreview.click\"\n}\n\n*/\n\n/* var sockHost = location.origin.replace(/^http/, 'ws') //'ws://katecode.herokuapp.com/sock'\n\n// ********** FOR EACH COMPONENT FOR EACH EVENT\n\nfunction ctaFileListener (ev) {\n    \n    console.log(sockHost)\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n            ws.send(JSON.stringify({\n                componentUri: 'windowDev.ctaFile.click',\n                m:'windowDev.ctaFile.click'\n            })) \n    }\n    ws.addEventListener('message', event => {\n                if(JSON.parse(event.data).m === 'windowDev.ctaFile.click') {\n                    document.em('windowDev.ctaFile.click')\n                }\n        })\n}\n\nfunction ctaImgCodeListener (ev) {\n    \n    var ws = new WebSocket(sockHost)\n    \n    ws.onopen = event => {\n        \n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.imgCode.click',\n            m:'windowDev.imgCode.click'\n        })) \n    }\n    ws.addEventListener('message', event => {\n                \n                if(JSON.parse(event.data).m === 'windowDev.imgCode.click') {\n                    document.em('windowDev.imgCode.click')\n                }\n        })\n}\n\nfunction ctaImgScriptListener (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.imgScript.click',\n            m:'windowDev.imgScript.click'\n        })) \n    }\n    ws.addEventListener('message', event => {\n                if(JSON.parse(event.data).m === 'windowDev.imgScript.click') {\n                    document.em('windowDev.imgScript.click')\n                }\n        })\n}\n\nfunction ctaImgCssListener (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.imgCss.click',\n            m:'windowDev.imgCss.click'\n        })) \n    }\n    ws.addEventListener('message', event => {\n                if(JSON.parse(event.data).m === 'windowDev.imgCss.click') {\n                    document.em('windowDev.imgCss.click')\n                }\n        })\n}\n\nfunction ctaImgPreviewListener (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.imgPreview.click',\n            m:'windowDev.imgPreview.click'\n        })) \n    }\n    ws.addEventListener('message', event => {\n                if(JSON.parse(event.data).m === 'windowDev.imgPreview.click') {\n                    document.em('windowDev.imgPreview.click')\n                }\n        })\n}\n\nfunction ctaFileListenerMouseLeave (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.ctaFile.mouseleave',\n            m:'windowDev.ctaFile.mouseleave'\n        })) \n    }\n        ws.addEventListener('message',  event => {\n            if(JSON.parse(event.data).m === 'windowDev.ctaFile.mouseleave') {\n                document.em('windowDev.ctaFile.mouseleave')\n            }\n        })\n}\n\nfunction textareaCodeKeyup (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n            \n            ws.send(JSON.stringify({\n                componentUri: 'windowDev.textareaCode.keyup',\n                m: textareaCode.value\n            }))\n    }\n    ws.addEventListener('message', event => {  \n            if(JSON.parse(event.data).componentUri === 'windowDev.textareaCode.keyup') {\n                document.em('windowDev.textareaCode.keyup',{code:JSON.parse(event.data).m})\n                //textareaCode.value = JSON.parse(event.data).m \n            }\n        })\n}\n\nfunction textareaScriptKeyup (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.textareaScript.keyup',\n            m: textareaScript.value\n        }))\n    }\n    ws.addEventListener('message', event => {  \n            if(JSON.parse(event.data).componentUri === 'windowDev.textareaScript.keyup') {\n                document.em('windowDev.textareaScript.keyup',{code:JSON.parse(event.data).m})\n                //textareaScript.value = JSON.parse(event.data).m\n            }\n        })\n}\n\nfunction textareaCssKeyup (ev) {\n    var ws = new WebSocket(sockHost)\n    ws.onopen = event => {\n        ws.send(JSON.stringify({\n            componentUri: 'windowDev.textareaCss.keyup',\n            m: textareaCss.value\n        }))\n    }\n    ws.addEventListener('message', event => {  \n            if(JSON.parse(event.data).componentUri === 'windowDev.textareaCss.keyup') {\n                textareaCss.value = JSON.parse(event.data).m\n            }\n        })\n}\n\ndocument.register('windowDev.ctaFile.click', ev => {\n    ctaFile.removeEventListener('click',ctaFileListener)\n    ctaFile.click()\n    ctaFile.addEventListener('click',ctaFileListener)\n})\n\ndocument.register('windowDev.imgCode.click', ev => {\n    imgCode.removeEventListener('click',ctaImgCodeListener)\n    imgCode.click()\n    imgCode.addEventListener('click',ctaImgCodeListener)\n})\n\ndocument.register('windowDev.imgScript.click', ev => {\n    imgScript.removeEventListener('click',ctaImgScriptListener)\n    imgScript.click()\n    imgScript.addEventListener('click',ctaImgScriptListener)\n})\n\ndocument.register('windowDev.imgCss.click', ev => {\n    imgCss.removeEventListener('click',ctaImgCssListener)\n    imgCss.click()\n    imgCss.addEventListener('click',ctaImgCssListener)\n})\n\ndocument.register('windowDev.imgPreview.click', ev => {\n    imgPreview.removeEventListener('click',ctaImgPreviewListener)\n    imgPreview.click()\n    imgPreview.addEventListener('click',ctaImgPreviewListener)\n})\n\ndocument.register('windowDev.ctaFile.mouseleave', ev => {\n    ctaFile.removeEventListener('mouseleave',ctaFileListenerMouseLeave)\n    ctaFile.dispatchEvent(new Event('mouseleave'))\n    ctaFile.addEventListener('mouseleave',ctaFileListenerMouseLeave)\n})\n\ndocument.register('windowDev.textareaCode.keyup', ev => {\n    textareaCode.removeEventListener('keyup',textareaCodeKeyup)\n    textareaCode.value = ev.detail.code\n    textareaCode.addEventListener('keyup',textareaCodeKeyup)\n})\n\ndocument.register('windowDev.textareaScript.keyup', ev => {\n    textareaScript.removeEventListener('keyup',textareaScriptKeyup)\n    textareaScript.value = ev.detail.code\n    textareaScript.addEventListener('keyup',textareaScriptKeyup)\n})\n\n\n\n\nctaFile.addEventListener('click',ctaFileListener)\nctaFile.addEventListener('mouseleave',ctaFileListenerMouseLeave)\n\nimgCode.addEventListener('click', ctaImgCodeListener)\nimgScript.addEventListener('click', ctaImgScriptListener)\nimgCss.addEventListener('click', ctaImgCssListener)\nimgPreview.addEventListener('click', ctaImgPreviewListener)\n\ntextareaCode.addEventListener('keyup', textareaCodeKeyup)\ntextareaScript.addEventListener('keyup', textareaScriptKeyup)\ntextareaCss.addEventListener('keyup', textareaCssKeyup)\n//textareaNode.addEventListener('keyup', textareaCodeKeyup)\n\n// ***************\n\n//document.register('ux.socket.started', ev => {\ndocument.register('windowDev.connectSocket', ev => {\n    ctaFile.click();\n    imgCode.click();\n    imgScript.click();\n    imgCss.click();\n    imgPreview.click();\n    ctaFile.dispatchEvent(new Event('mouseleave'));\n    textareaCode.dispatchEvent(new Event('keyup'))\n    //ctaFile.dispatchEvent(new Event('mouseleave'))\n    textareaScript.dispatchEvent(new Event('keyup'))\n    textareaCss.dispatchEvent(new Event('keyup'))\n}) */\n\n\n    //ctaFileListener()\n\n    //document.em('windowDev.ctaFile.click')\n//})\n\n\n// *************** END SOCKET\n\n\ndocument.em(\"windowDev.print\", layoutTabber())\n\n\n\n\n    //document.db.Project[document.UI.currentProjectID].Component.push({\n    //        name: 'newComponent'+document.db.Project[document.UI.currentProjectID].Component.length,\n    //        ux: \"div root\",\n    //        js: '',\n    //        css: '',\n    //        node: ''\n    //})\n\n    \n    //document.UI.currentComponentID = document.db.Project[document.UI.currentProjectID].Component.length-1\n    //document.em('windowDev.loadComponent', {ProjectID: document.UI.currentProjectID, ComponentID:document.UI.currentComponentID})\n\n\n\n\n",
      "css": ".fileName {\n    padding: 8px;\n    font-size: 25px;\n    border-width: 1px;\n    border-color: #CCCCCC;\n    background-color: #FFFFFF;\n    color: #000000;\n    border-style: hidden;\n    border-radius: 13px;\n    box-shadow: 9px 9px 18px rgba(179,61,116,.75);\n    text-shadow: 0px 0px 0px rgba(66,66,66,.75);\n}\n.fileName:focus {\n    outline:none;\n}\n\n.menu {\n    margin: 0 5px;\n    padding: 0;\n    font-family: Open Sans, Courier New;\n    font-size: 12px;\n    color: white;\n    cursor: pointer;\n}\n\n.topBar {\n    background: rgb(60,57,57);\n    background: radial-gradient(circle, rgba(60,57,57,1) 0%, rgba(60,58,58,1) 100%, rgba(86,110,159,1) 100%);\n}\n\n.topBarNewTest {\n    background-color: black;\n}",
      "dom": {
        "contentArea": {}
      }
    },
        {
      "name": "head",
      "text": "",
      "ux": "div head\n    meta\n        .charset utf-8\n    meta\n        .name viewport\n        .content width=device-width, initial-scale=1, shrink-to-fit=no\n    meta \n        .http-equiv x-ua-compatible\n        .content ie=edge\n        \n    link \n        .rel icon\n        .type image/png\n        .href /json?serviceName=getim&key=faviconFace\n\n    link\n        .href https://use.fontawesome.com/releases/v5.15.2/css/all.css\n        .rel stylesheet\n    link\n        .href https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap\n        .rel stylesheet\n\n    link \n        .rel stylesheet\n        .href https://fonts.googleapis.com/icon?family=Material+Icons\n\n    link\n        .rel stylesheet\n        .href https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css\n        .integrity sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l\n        .crossOrigin anonymous\n\n    link\n        .rel stylesheet\n        .type text/css\n        .href https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css\n\n    link\n        .rel stylesheet\n        .href https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css\n\n    LINK\n        .rel stylesheet\n        .href https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/styles/a11y-dark.min.css\n\n    SCRIPT\n        .src https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/highlight.min.js\n\n\n    SCRIPT\n        .src https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.1/languages/go.min.js\n\n        \n    script\n        .src https://unpkg.com/@popperjs/core@2.4.0/dist/umd/popper.min.js\n    script\n        .src https://code.jquery.com/jquery-3.2.1.slim.min.js\n        .integrity sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN\n        .crossOrigin anonymous        \n    script\n        .src https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js\n        .integrity sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf\n        .crossOrigin anonymous\n\n    script\n        .src https://cdnjs.cloudflare.com/ajax/libs/markdown-it/12.0.4/markdown-it.min.js\n        .integrity sha512-0DkA2RqFvfXBVeti0R1l0E8oMkmY0X+bAA2i02Ld8xhpjpvqORUcE/UBe+0KOPzi5iNah0aBpW6uaNNrqCk73Q==\n        .crossOrigin anonymous\n\n    script \n        .src https://polyfill.io/v3/polyfill.min.js?features=es6\n\n    script\n        .id MathJax-script\n        .src https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\n        .async true\n\n    script mathjaxs\n\n\n\n    title 'Kate Code",
      "js": "eventConf()\nrestConf()\n\n\n\n\nmathjaxs.innerHTML = `\nMathJax = {\n    tex: { \n        inlineMath: [['$', '$']] \n    }, \n  startup: {\n    ready: () => {\n      //\n      //  Get some MathJax objects from the MathJax global\n      //\n      //  (Ideally, you would turn this into a custom component, and\n      //  then these could be handled by normal imports, but this is\n      //  just an example and so we use an expedient method of\n      //  accessing these for now.)\n      //\n      const mathjax = MathJax._.mathjax;\n      const HTMLAdaptor = MathJax._.adaptors.HTMLAdaptor.HTMLAdaptor;\n      const HTMLHandler = MathJax._.handlers.html.HTMLHandler.HTMLHandler;\n      const AbstractHandler = MathJax._.core.Handler.AbstractHandler.prototype;\n      const startup = MathJax.startup;\n\n      //\n      //  Extend HTMLAdaptor to handle shadowDOM as the document\n      //\n      class ShadowAdaptor extends HTMLAdaptor {\n        create(kind, ns) {\n          const document = (this.document.createElement ? this.document : this.window.document);\n          return (ns ?\n                  document.createElementNS(ns, kind) :\n                  document.createElement(kind));\n        }\n        text(text) {\n          const document = (this.document.createTextNode ? this.document : this.window.document);\n          return document.createTextNode(text);\n        }\n        head(doc) {\n          return doc.head || doc;\n        }\n        body(doc) {\n          return doc.body || doc;\n        }\n        root(doc) {\n          return doc.documentElement || doc;\n        }\n        allAttributes(node) {\n          return (node.attributes ? super.allAttributes(node) : []);\n        }\n      }\n\n      //\n      //  Extend HTMLHandler to handle shadowDOM as document\n      //\n      class ShadowHandler extends HTMLHandler {\n        create(doc, options) {\n          const adaptor = this.adaptor;\n          if (typeof(doc) === 'string') {\n            document = adaptor.parse(doc, 'text/html');\n          } else if ((doc instanceof adaptor.window.HTMLElement ||\n                      doc instanceof adaptor.window.DocumentFragment) &&\n                     !(doc instanceof window.ShadowRoot)) {\n            let child = doc;\n            doc = adaptor.parse('', 'text/html');\n            adaptor.append(adaptor.body(doc), child);\n          }\n          //\n          //  We can't use super.create() here, since that doesn't\n          //    handle shadowDOM correctly, so call HTMLHandler's parent class\n          //    directly instead.\n          //\n          return AbstractHandler.create.call(this, doc, options);\n        }\n      }\n\n      //\n      //  Register the new handler and adaptor\n      //\n      startup.registerConstructor('HTMLHandler', ShadowHandler);\n      startup.registerConstructor('browserAdaptor', () => new ShadowAdaptor(window));\n\n      //\n      //  A service function that creates a new MathDocument from the\n      //  shadow root with the configured input and output jax, and then\n      //  renders the document.  The MathDocument is returned in case\n      //  you need to rerender the shadowRoot later.\n      //\n      MathJax.typesetShadow = function (root) {\n        const InputJax = startup.getInputJax();\n        const OutputJax = startup.getOutputJax();\n        const html = mathjax.mathjax.document(root, {InputJax, OutputJax});\n        html.render();\n        return html;\n      }\n\n      //\n      //  Now do the usual startup now that the extensions are in place\n      //\n      MathJax.startup.defaultReady();\n    }\n  }\n};\n`\n\n\n\n\n/*\n\n    script\n        .src https://unpkg.com/@reactivex/rxjs@6.0.0/dist/global/rxjs.umd.js\n\n    script \n        .src https://d3js.org/d3.v6.min.js\n    script \n        .src https://d3js.org/d3-dispatch.v2.min.js\n    script\n        .src https://d3js.org/d3-selection.v2.min.js\n    script \n        .src https://d3js.org/d3-drag.v2.min.js\n\n\n    script \n        .src https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/shim.min.js\n        .integrity sha512-nPnkC29R0sikt0ieZaAkk28Ib7Y1Dz7IqePgELH30NnSi1DzG4x+envJAOHz8ZSAveLXAHTR3ai2E9DZUsT8pQ== \n        .crossOrigin anonymous\n        .referrerPolicy no-referrer\n\n    script\n        .src https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js\n        .integrity sha512-ZfFfcp0ll1jVjeG5e7uPH1hwUyeoBUVAb3xRJpqBsH90jVegaYKv5nGOhGnUYxZg/kbYpl6EWVGvmWrbV32L9Q==\n        .crossOrigin anonymous \n        .referrerPolicy no-referrer\n\n    script\n        .type text/javascript\n        .charset UTF-8\n        .src https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js\n\n\n\n\n\n    script \n        .async true \n        .src https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6995551176842381\n        .crossOrigin anonymous\n\n    script \n        .async true\n        .src https://www.googletagmanager.com/gtag/js?id=UA-214569051-1\n\n    script googleAnalitycsCode\n\n*/",
      "css": "",
      "dom": {}
    },
    {
      "name": "eventConf",
      "text": "",
      "ux": "div root\n",
      "js": "let services = []\n\nfunction dispatch (eventName, msg) {\n    console.log('dispatch - ' + eventName);\n    var detail = {detail: msg};\n    document.dispatchEvent(new CustomEvent(eventName, detail));\n}\n\n    \nfunction register (eventName, callback){\n    services.forEach((e,i,a)=>{\n        if(e.eventName==eventName){\n            document.removeEventListener(e.eventName, e.callback,true)\n            document.removeEventListener(e.eventName, e.callback,false)\n            services.splice(i,1)\n        }\n    })\n\n    services.push({eventName: eventName, callback: callback})\n    document.addEventListener(eventName, callback);\n        \n}\n    \nfunction unregister (eventName, callback){\n    document.removeEventListener(eventName, callback);\n}\n    \nfunction registerDefault (callback){\n    document.addEventListener(callback.name, callback);\n}\n    \ndocument.registerDefault = registerDefault\ndocument.em = dispatch\ndocument.register = register\ndocument.unregister = unregister\n\n\n\n\n/*     try {\n   // *****************\n// *** SOCKET CONF\nvar sockHost = location.origin.replace(/^http/, 'ws') //'ws://katecode.herokuapp.com/sock'\nvar ws = new WebSocket(sockHost)\nws.onopen = event => {\n    //ws.send('ux.app.session.start') \n    document.em('ux.socket.started')\n}\n\n//document.ws = ws \n    } catch (err) {\n\n    } */\n",
      "css": ""
    },
    {
      "name": "restConf",
      "text": "",
      "ux": "div root",
      "js": "function json(serviceName, msg){\n    return new Promise( (resolve, reject) => {\n        // prendo i cookie\n        // document.cookie = \"user=admin@katecode.com;pass=admin\"\n        \n        //document.cookie = \"user=admin@katecode.com;pass=admin\"\n        //document.cookie = \"pass=admi\"\n        \n\n        var props = document.cookie.split(';')\n\n        var mail = '' //document.UI.currentMail\n        var pass = '' //document.UI.currentPassword\n\n        props.forEach(v => {\n          var tokens = v.split('=')\n          if(tokens[0]=='user'){\n            user = tokens[1]\n          }\n          if(tokens[0].trim()=='pass'){\n            pass = tokens[1]\n          }\n        })\n\n        fetch('/json?serviceName='+serviceName + '&' + new URLSearchParams(msg), {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n        }).then( response => {\n            return response.json()\n        }).then(data => {\n            console.log('fetching response ... data is + ' + JSON.stringify(data))\n            resolve(data)\n        }).catch(error => {\n            reject(error)\n        });\n    })\n}\n\nfunction postJson(serviceName, msg){\n  return new Promise( (resolve, reject) => {\n\n      var mail = document.UI.currentMail\n      var pass = document.UI.currentPassword\n      var url = document.db.Project[document.UI.currentProjectID].url\n\n      fetch('/json', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({meta: {serviceName: serviceName, mail:mail, pass:pass, url:url, data: msg}})\n      }).then( response => {\n          return response.json()\n      }).then(data => {\n          console.log('fetching response ... data is + ' + JSON.stringify(data))\n          resolve(data)\n      }).catch(error => {\n          reject(error)\n      });\n  })\n}\n\nfunction postJsonNew(serviceName, msg){\n  return new Promise( (resolve, reject) => {\n\n      var mail = document.UI.currentMail\n      var pass = document.UI.currentPassword\n      var url = document.db.Project[document.UI.currentProjectID].url\n\n      fetch('/json', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({meta: {serviceName: serviceName, mail:mail, pass:pass, url:url}, data: msg})\n      }).then( response => {\n          return response.json()\n      }).then(data => {\n          console.log('fetching response ... data is + ' + JSON.stringify(data))\n          resolve(data)\n      }).catch(error => {\n          reject(error)\n      });\n  })\n}\n\ndocument.json = json;\ndocument.postJson = postJson;",
      "css": "",
      "dom": {}
    },
        {
      "name": "body",
      "text": "",
      "ux": "div body\n    *app",
      "js": "",
      "css": ""
    },
    {
      "name": "db",
      "ux": "div root\n    -zIndex 1000\n    -display none\n    span cp '0\n        -position fixed\n        -bottom 5px\n        -left 5px\n        -color blue\n    span cc '0\n        -position fixed\n        -bottom 5px\n        -left 30px\n        -color blue    ",
      "js": "let SimpleProxy = class {\n    target = {}\n    \n    handler = {\n        observers: [],    \n        set(target, prop, receiver){\n            this.observers.forEach((e, i, a) => {\n                e(receiver, target.value)\n            })\n            target.value = receiver\n        }\n    }\n    \n    constructor(value){\n        this.target.value = value\n        this.proxy = new Proxy(this.target, this.handler)\n    }\n\n    subscribe(f) {\n        this.handler.observers.push(f)\n    }\n}\n\n\n\n\nfunction uiman (opt) {\n    return {\n        currentProjectID: 0,\n        currentComponentID: 0,\n        currentMail: undefined,\n        currentPassword: undefined,\n        isLogged: new SimpleProxy(false),\n        isProd: new SimpleProxy(true)\n    }\n}\n\n\n\n//document.db = JSON.parse(decodeURIComponent(document.getElementById('ux-local-store').textContent)); //dbman()\n\n\n\n\ndocument.UI = uiman()\n\n\ndocument.register(\"currentProjectID\", ev => {\n    document.UI.currentProjectID = ev.detail\n    cp.innerHTML = ev.detail\n})\n\ndocument.register(\"currentComponentID\", ev => {\n    document.UI.currentComponentID = ev.detail\n    cc.innerHTML = ev.detail\n})\n\n\n\n//let prj = document.db.Project[document.UI.currentProjectID]\n//document.json(\"getData\", {url: prj.url}).then(json => {\n//    prj.Data = json\n//})\n\n// GET PUBLIC POSTS\ndocument.db.Project[0].Data = {}\n//document.json(\"pullPost\").then(json => {\n    //document.db.Project[0].Data.Post = json\n//})\n\ndocument.register(\"db.isLogged\", ev => {\n    document.UI.isLogged.proxy.value = ev.detail\n})",
      "css": "",
      "text": ""
    },
    {
      "name": "menuFile",
      "text": "",
      "ux": "div root\n    -position fixed\n    -border 1px solid white\n    -background rgb(60,57,57)\n    -background radial-gradient(circle, rgba(60,57,57,1) 0%, rgba(60,58,58,1) 100%, rgba(86,110,159,1) 100%)\n    \n    div ctaNewProject 'New Project\n        .class mnu-item\n\n    div ctaOpen 'Open Project\n        .class mnu-item\n\n    div ctaSave 'Save Project\n        .class mnu-item\n\n    div ctaSaveComp 'Save Component\n        .class mnu-item\n\n    div ctaCommitComp 'Commit Service\n        .class mnu-item\n\n    div ctaSavePost 'Save Post\n        .class mnu-item\n\n    div ctaAddToLib 'Add to lib\n        .class mnu-item\n\n    div ctaImport 'Import\n        .class mnu-item\n\n    div 'Import GitHub Project\n        .class mnu-item\n\n    div ctaDownload 'Download Kate Code\n        .class mnu-item\n\n    div ctaDownloadApp 'Download App(project name)\n        .class mnu-item\n\n    div ctaDownloadComp 'Download Component(component name)\n        .class mnu-item\n\n    div ctaDownloadKateProject 'Download Project (Editor + Project)\n        .class mnu-item\n",
      "js": "\ndocument.UI.isLogged.subscribe((newValue, oldValue)=>{\n\n    if(newValue){\n        ctaNewProject.onclick = ev => {\n            document.em(\"windowDev.print\", newProject2())\n            root.style.display = 'none'\n        }\n    } else {\n        ctaNewProject.onclick = undefined\n    }\n\n    \n})\n\n\nctaOpen.onclick = ev => {\n    let url = prompt('Project URL')\n\n    document.postJson('pullProject', {projectUrl: url}).then(json => {\n        if(json.esito==undefined){\n            document.db.Project.push(json.Project)\n        }\n    })\n}\n\n\n\n\nctaSave.onclick = ev => {\n    let prj = document.db.Project[document.UI.currentProjectID]\n    prj.Component.forEach( (e, i, a) => {\n        console.log(e.name)\n        if(e.name!=='uxstyle'){\n            document.postJson('pushComp', {url: prj.url, comp:e, pass:document.UI.currentPassword}).then(json => {\n                if(json.esito == \"no no\"){\n                    document.em(\"toast\", \"No Password\")\n                } else {\n                    document.em(\"toast\", e.name + \" saved!\")\n                }\n                \n            })\n        }\n    })\n}\n\ndocument.register(\"menuFile.ctaSave\", ev => {\n    ctaSave.click()\n})\n\n\nctaSaveComp.onclick = ev => {\n    let prj = document.db.Project[document.UI.currentProjectID]\n    let comp = prj.Component[document.UI.currentComponentID]\n    document.postJson('pushComp', {url: prj.url, comp: comp, pass:document.UI.currentPassword}).then(json => {\n        if(json.esito == \"no no\"){\n            document.em(\"toast\", \"No Password\")\n        } else {\n            document.em(\"toast\", Date.now() + \" - \" +comp.name + \" saved!\")\n        } \n    })\n}\n\n\n\nctaCommitComp.onclick = ev => {\n    let prj = document.db.Project[document.UI.currentProjectID]\n    let comp = prj.Service[document.UI.currentServiceID]\n    document.postJson('pushComp', {url: prj.url, comp: comp, pass:document.UI.currentPassword}).then(json => {\n        if(json.esito == \"no no\"){\n            document.em(\"toast\", \"No Password\")\n        } else {\n            document.em(\"toast\", Date.now() + \" - \" +comp.name + \" saved!\")\n        } \n    })\n}\n\n\nctaSavePost.onclick = ev => {\n    let postID = prompt(\"PostID\")\n    let prj = document.db.Project[document.UI.currentProjectID]\n   \n    document.postJson('pushPost', {url: prj.url, post: prj.Data.Post[postID], pass:document.UI.currentPassword}).then(json => {\n        if(json.esito == \"no no\"){\n            document.em(\"toast\", \"No Password\")\n        } else {\n            document.em(\"toast\", Date.now() + \" - Post saved!\")\n        }\n        \n    })\n}\n\n\n\nctaDownload.onclick = ev => {\n    fetch('/').then(function (response) {\n        // The API call was successful!\n        return response.text();\n    }).then(function (html) {\n    \n        // Convert the HTML string into a document object\n        var parser = new DOMParser();\n        var doc = parser.parseFromString(html, 'text/html');\n        var ux_store = doc.getElementById('ux-local-store');\n        var ux_assets_js = doc.getElementById('ux-assets-script')\n        var ux_assets_css = doc.getElementById('ux-assets-css')\n        \n        // STORE IS A GLOBAL VARIABLE\n        ux_store.innerHTML = JSON.stringify(store)\n        \n\n        // CAPIAMO COME LEGGERE GLI ASSETS\n        // docum\n        var links = doc.body.getElementsByTagName('link');\n        var scripts = doc.body.getElementsByTagName('link');\n\n\n        var a = document.createElement(\"a\")\n        a.download = \"file.html\"\n        a.href = \"data:text/plain;charset=utf-8,\" + encodeURIComponent(doc.documentElement.outerHTML)\n        a.click()\n    }).catch(function (err) {\n        // There was an error\n        console.warn('Something went wrong.', err);\n    });\n}\n\nctaDownloadApp.onclick = ev => {\n    cp = document.UI.currentProjectID\n    cc = document.UI.currentComponentID\n\n    const scriptsArr = []\n    console.log('Compiling component + head + restConf + eventConf + db')\n    document.db.Project[cp].Component.forEach( (e,i,a)=>{\n        console.log('Component name: ' + e.name)\n        scriptsArr.push(ux.parserJSFunction(e.name,e.ux,e.js,e.css))\n    })\n\n    var scriptTag = document.createElement('script')\n    scriptTag.textContent = ''\n    scriptsArr.forEach(v => {\n        scriptTag.textContent += v\n    })\n\n    scriptTagText = encodeURIComponent(scriptTag.innerHTML)\n\n    var scriptTagBootstrap = document.createElement('script')\n    scriptTagBootstrap.textContent = `\n\n    window.addEventListener('DOMContentLoaded', (event) => {\n        var codeGenScript = document.getElementById('ux-gen-code')\n\n        var newScriptTag = document.createElement('script')\n        newScriptTag.textContent = decodeURIComponent(codeGenScript.textContent)\n        document.body.appendChild(newScriptTag)\n        //document.head.appendChild(head());\n        window.onload = () => {\n            document.body.appendChild(${document.db.Project[cp].Component[cc].name}());\n            //document.db = JSON.parse(document.getElementById('ux-local-store').innerHTML);\n            //document.getElementById('ux-local-store').innerHTML = JSON.stringify(store);\n        }\n    });\n    `\n\n    var componentBundler = '<!DOCTYPE html><html><head>'+ scriptTagBootstrap.outerHTML + '</head><body><div id=\"ux-md\" style=\"display:none\"></div><div id=\"ux-db\" style=\"display:none\"></div><div id=\"ux-gen-code\" style=\"display:none\">'+encodeURIComponent(scriptTagText)+'</div></body></html>';\n\n    var a = document.createElement(\"a\")\n    a.download = \"app.html\"\n    a.href = \"data:text/plain;charset=utf-8,\" + componentBundler\n    a.click()\n}\n\nctaDownloadComp.onclick = ev => {\n\n    //var code = ux.parserJSFunction('functionName_'+count,textareaCode.value, textareaScript.value, textareaCss.value);\n\n    const scriptsArr = []\n\n    console.log('Compiling component + head + restConf + eventConf + db')\n    document.db.Project[0].Component.forEach( (e,i,a)=>{\n        console.log('Component name: ' + e.name)\n        scriptsArr.push(ux.parserJSFunction(e.name,e.ux,e.js,e.css))\n    })\n\n    var scriptTag = document.createElement('script')\n    scriptTag.textContent = ''\n    scriptsArr.forEach(v => {\n        scriptTag.textContent += v\n    })\n\n    scriptTagText = scriptTag.outerHTML\n\n    var scriptTagBootstrap = document.createElement('script')\n    scriptTagBootstrap.textContent = `\n    window.addEventListener('DOMContentLoaded', (event) => {\n        document.head.appendChild(head());\n        window.onload = () => {\n            document.body.appendChild(${document.db.Project[0].Component[document.UI.currentComponentID].name}());\n            //document.db = JSON.parse(document.getElementById('ux-local-store').innerHTML);\n            //document.getElementById('ux-local-store').innerHTML = JSON.stringify(store);\n        }\n    });\n    `\n\n    var componentBundler = '<!DOCTYPE html><html><head>'+ scriptTagBootstrap.outerHTML + '</head><body><div id=\"ux-md\" style=\"display:none\"></div><div id=\"ux-db\" style=\"display:none\"></div>'+scriptTagText+'</body></html>';\n\n    var a = document.createElement(\"a\")\n    a.download = \"app.html\"\n    a.href = \"data:text/plain;charset=utf-8,\" + encodeURIComponent(componentBundler)\n    a.click()\n} \n\n\nctaDownloadKateProject.onclick = ev => {\n    document.em('runBundler')\n}\n\nctaAddToLib.onclick = ev => {\n    let comp = document.db.Project[document.UI.currentProjectID].Component[document.UI.currentComponentID]\n    let id = prompt(\"ID\")\n    \n    document.postJson(\"addToCompLib\", {ID: parseInt(id), Component: comp, pass:document.UI.currentPassword}).then(json => {\n        if(json.esito == \"no no\"){\n            document.em(\"toast\", \"No Password\")\n        } else {\n            document.em(\"toast\", Date.now() + \" - Done!\")\n        }\n    })\n\n}",
      "css": ".mnu-item {\n    cursor: pointer;\n    margin: 5px 5px;\n    padding: 10px;\n    font-family: \"Open Sans\", \"Courier New\";\n    font-size: 12px;\n    color: white;\n}\n\n.mnu-item:hover {\n    background: radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%);\n}"
    },
    {
      "name": "menuProject",
      "text": "",
      "ux": "div root\n    -position fixed\n    -border 1px solid white\n    -background rgb(60,57,57)\n    -background radial-gradient(circle, rgba(60,57,57,1) 0%, rgba(60,58,58,1) 100%, rgba(86,110,159,1) 100%)\n\n    div ctaNewNodeService 'Launch New Node Service\n        .class mnu-item\n  \n    div ctaViewProjects 'View Projects\n        .class mnu-item\n\n    div ctaViewComponents 'View Components\n        .class mnu-item\n\n    div ctaHtml 'View html\n        .class mnu-item\n\n    div ctaJs 'View js\n        .class mnu-item\n\n    div ctaCss 'View css\n        .class mnu-item\n\n    div ctaRedeploy 'Redeploy\n        .class mnu-item\n\n    div ctaPreview 'Preview\n        .class mnu-item",
      "js": "ctaNewNodeService.onclick = ev => {\n    document.em(\"windowDev.print\", newNodeService())\n}  \n\nctaViewProjects.onclick = ev=> {\n    document.em(\"viewProjects.open\")\n}\n\nctaViewComponents.onclick = ev=> {\n    document.em(\"viewComponents.open\")\n}\n\nctaHtml.onclick = ev=> { \n    document.em(\"windowDev.showCode\")\n}\n\nctaJs.onclick = ev=> { \n    document.em(\"windowDev.showScript\")\n}\n\nctaCss.onclick = ev=> { \n    document.em(\"windowDev.showCss\")\n}\n\nctaRedeploy.onclick = ev=> {\n    document.getElementById('ux-local-store').textContent = encodeURIComponent(JSON.stringify(document.db))\n\n    var appTag = document.querySelector('[ux-comp-name=\"body\"]')\n    appTag.parentNode.removeChild(appTag)\n    document.body.appendChild(body());\n}\n\nctaPreview.onclick = ev=> { \n    document.em(\"windowDev.imgPreview\")\n}",
      "css": ".mnu-item {\n    cursor: pointer;\n    margin: 5px 5px;\n    padding: 10px;\n    font-family: \"Open Sans\", \"Courier New\";\n    font-size: 12px;\n    color: white;\n}\n\n.mnu-item:hover {\n    background: radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%);\n}"
    },
    {
      "name": "menuData",
      "text": "",
      "ux": "div root\n    -position fixed\n    -border 1px solid white\n    -background rgb(60,57,57)\n    -background radial-gradient(circle, rgba(60,57,57,1) 0%, rgba(60,58,58,1) 100%, rgba(86,110,159,1) 100%)\n\n    div ctaNewPost 'New Post\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaPostList 'Post List\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaPullData 'Pull Data\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white  \n\n    div ctaBrowseImages 'Browse Images\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white   \n\n    div ctaImageLoader 'Image Loader\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white  \n\n    div ctaViewStore 'View DB\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaViewProjects 'Projects\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaViewComponents 'Components\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaViewNodeServices 'Node Services\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaViewNodeServicesWithPreview 'Node Services & Preview\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div 'Project Properties\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div 'Events Graph\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white",
      "js": "ctaNewPost.onclick = ev => {\n    document.em(\"windowDev.print\", newPost())\n}\n\nctaPullData.onclick = ev => {\n    let prj = document.db.Project[document.UI.currentProjectID]\n    document.postJson(\"getData\", {url: prj.url, query:JSON.stringify({ID:1})}).then(json => {\n        prj.Data = json.Data\n    }).catch(err=>alert(err))\n\n    document.db.Project[document.UI.currentProjectID].Service = []\n    document.postJson(\"nodeServiceList\", {pass:document.UI.currentPassword}).then(json => {\n        document.db.Project[document.UI.currentProjectID].Service = json\n        document.em(\"uxgit.loadServices\")\n    }).catch(err=>alert(err))\n\n    \n}\n\nctaBrowseImages.onclick = ev => {\n    document.em(\"windowDev.print\", imageBrowser())\n}\n\nctaImageLoader.onclick = ev => {\n    document.em(\"windowDev.print\", imageLoader())\n}\n\nctaPostList.onclick = ev => {\n    document.em(\"windowDev.print\", postList())\n}\n\n\nctaViewStore.onclick = ev => {\n\n    var p = document.createElement('textarea')\n    \n    p.style.width = '100%'\n\n    p.value = JSON.stringify(document.db,null,4)\n\n    document.em('windowDev.print',p)\n}\n\nfunction viewComponentsAsTable() {\n\n    var comps = document.db.Project[document.UI.currentProjectID].Component\n\n    let table = document.createElement('table')\n    let thead = document.createElement('thead')\n    let trh = document.createElement('tr')\n    let tdh1 = document.createElement('td')\n    let tdh2 = document.createElement('td')\n    \n    tdh1.innerHTML = \"#\"\n    tdh2.innerHTML = \"Component\"\n    \n    trh1.append(tdh1,tdh2)\n    \n    comps.forEach( (e,i,a) => {\n        let trh = document.createElement('tr')\n        let td1 = document.createElement('td')\n        let td2 = document.createElement('td')\n    })\n}\n\n\n\nctaViewComponents.onclick = ev => {\n    document.em(\"viewComponents.open\")\n}\n\nctaViewNodeServices.onclick = ev => {\n    document.em(\"windowDev.print\", nodeServiceList())\n}\n\nctaViewNodeServicesWithPreview.onclick = ev => {\n    document.em(\"windowDev.print\", masterDetailNode())\n}\n\nctaViewProjects.onclick = ev => {\n    document.em(\"viewProjects.open\")\n}",
      "css": "",
      "dom": {}
    },
    {
      "name": "menuLearn",
      "text": "",
      "ux": "div root\n    -position fixed\n    -border 1px solid white\n    -background rgb(60,57,57)\n    -background radial-gradient(circle, rgba(60,57,57,1) 0%, rgba(60,58,58,1) 100%, rgba(86,110,159,1) 100%)\n\n    div ctaGetStarted 'Get Started\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white  \n\n    div ctaSample 'Sample Components\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white    \n\n    div ctaUx 'UX\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaCss 'CSS\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaJs 'javaScript\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n\n    div ctaKateCommunity 'Kate Community\n        -cursor pointer\n        -margin 5px 5px\n        -padding 10px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n   ",
      "js": "ctaUx.onclick = ev => {\n    let posts = document.db.Project[document.UI.currentProjectID].Data.Post\n    \n    posts.forEach( (e, i, a) => {\n        if(e.title == \"UX\"){\n            let md = window.markdownit()\n    \n            let d = document.createElement('div')\n            d.innerHTML = md.render(e.post)\n            document.em('windowDev.print',  viewPost(d))\n        }\n    })\n}\n\nctaSample.onclick = ev => {\n    document.em('windowDev.print',compPreview())\n}\n\nfunction getPost(title) {\n    let posts = document.db.Project[document.UI.currentProjectID].Data.Post\n    \n    posts.forEach( (e, i, a) => {\n        if(e.title == title){\n            let md = window.markdownit()\n    \n            let d = document.createElement('div')\n            d.innerHTML = md.render(e.post)\n            document.em('windowDev.print',  viewPost(d))\n        }\n    })\n}\n\nctaCss.onclick = ev => {\n    getPost(\"CSS\")\n}\n\nctaGetStarted.onclick = ev => {\n    getPost(\"GetStarted\")\n}\n\nctaKateCommunity.onclick = ev => {\n    getPost(\"community\")\n}",
      "css": ""
    },
    {
      "name": "layoutTabber",
      "ux": "div root\n    -width 100%\n    -display flex\n    -flexDirection column\n    div\n        -display flex\n        -flexGrow 1\n        div sidebarMenu\n            -display flex\n            -flexDirection column\n            -justifyContent space-between\n            -gap 20px\n            -backgroundColor rgb(51,51,51)\n            -color white\n            div\n                div\n                    .class imgWrapper\n                    img ctaJs\n                        -width 35px\n                        .src /json?serviceName=getim&key=htmlLogo          \n                div\n                    .class imgWrapper    \n                    img ctaNode\n                        -width 35px\n                        .src /json?serviceName=getim&key=nodeIcon2\n                div\n                    .class imgWrapper\n                    img ctaPython\n                        -width 35px\n                        .src /json?serviceName=getim&key=pythonLogo\n                div\n                    -display none\n                    .class imgWrapper\n                    img ctaRuby\n                        -width 35px\n                        .src /json?serviceName=getim&key=rubyOnRailsLogo.png\n                div\n                    .class imgWrapper\n                    img ctaGo\n                        -width 35px\n                        .src /json?serviceName=getim&key=goLogo   \n                div\n                    .class imgWrapper\n                    img ctaMongo\n                        -width 35px\n                        .src /json?serviceName=getim&key=mongo3 \n                div\n                    .class imgWrapper\n                    img ctaMarkdown\n                        -width 35px\n                        .src /json?serviceName=getim&key=markdownLogo3 \n\n\n            div\n                -display flex\n                -flexDirection column\n                -justifyContent space-around\n\n                div\n                    .class imgWrapper\n                    *login\n\n                div\n                    .class imgWrapper\n                    img ctaSlack\n                        -width 35px\n                        .src /json?serviceName=getim&key=slack\n\n                div\n                    .class imgWrapper\n                    img ctaStackoverflow\n                        -width 35px\n                        .src /json?serviceName=getim&key=stackoverflow\n\n                div\n                    .class imgWrapper\n                    img ctaSettings\n                        -width 35px\n                        .src /json?serviceName=getim&key=settingsLogo\n\n        div sidebar\n            -height 0\n            -minHeight 100%\n            -overflowY auto\n            *projectExplorer\n        div main\n            -flexGrow 10\n            -maxHeight 100%\n            -xOverflow auto\n            *tabber\n    div\n        -backgroundColor rgb(0,123,211)\n        -color white\n        span ctaUxGit 'master*\n        span '      |\n        span currentComponentName ",
      "js": "ctaJs.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(projectExplorer())\n    document.em(\"layoutTabber.toggle\")\n}\n\nctaNode.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(nodejsExplorer())\n    document.em(\"layoutTabber.nodejsLayer\")\n}\n\nctaPython.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(pythonExplorer())\n    document.em(\"layoutTabber.pythonLayer\")\n}\n\nctaGo.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(goExplorer())\n    document.em(\"layoutTabber.goLayer\")    \n}\n\nctaMongo.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(mongoExplorer())\n    document.em(\"layoutTabber.mongoLayer\")      \n}\n\nctaMarkdown.onclick = ev => {\n    sidebar.innerHTML = \"\"\n    sidebar.append(markdownExplorer())\n    document.em(\"layoutTabber.markdownLayer\")      \n}\n\nctaSettings.onclick = ev => {\n    document.em(\"tabber.print\", settingsPanel())\n}\n\nctaUxGit.onclick = ev => {\n    document.em(\"uxgit.open\")\n}\n\nlet isOpen = true\nlet activeLayer = \"js\" // js, node, python, ruby, go\ndocument.register(\"layoutTabber.toggle\", ev => {\n    if(isOpen && activeLayer == \"js\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"js\"\n    }\n})\n\ndocument.register(\"layoutTabber.nodejsLayer\", ev => {\n    if(isOpen && activeLayer == \"node\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"node\"\n    }    \n})\n\ndocument.register(\"layoutTabber.pythonLayer\", ev => {\n    if(isOpen && activeLayer == \"python\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"python\"\n    } \n})\n\ndocument.register(\"layoutTabber.goLayer\", ev => {\n    if(isOpen && activeLayer == \"go\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"go\"\n    } \n})\n\ndocument.register(\"layoutTabber.mongoLayer\", ev => {\n    if(isOpen && activeLayer == \"mongo\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"mongo\"\n    } \n})\n\ndocument.register(\"layoutTabber.markdownLayer\", ev => {\n    if(isOpen && activeLayer == \"markdown\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"markdown\"\n    } \n})\n\ndocument.register(\"layoutTabber.cssLayer\", ev => {\n    if(isOpen && activeLayer == \"css\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.innerHTML = \"\"\n        sidebar.append(cssStyleExplorer())\n        \n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"css\"\n    } \n})\n\ndocument.register(\"layoutTabber.animationsLayer\", ev => {\n    if(isOpen && activeLayer == \"animations\"){\n        sidebar.style.display = \"none\"\n        isOpen = false\n    }\n    else {\n        sidebar.innerHTML = \"\"\n        sidebar.append(animationsExplorer())\n        \n        sidebar.className = \"sidebar\"\n        sidebar.style.display = \"initial\"\n        isOpen = true\n        activeLayer = \"animations\"\n    } \n})\n\ndocument.register(\"windowDev.loadComponentNext\", ev => {\n    var cp = ev.detail.ProjectID\n    var cc = ev.detail.ComponentID    \n\n    currentComponentName.textContent = document.db.Project[cp].Component[cc].name\n})\n\n\n",
      "css": "img {\n    margin: 0.5rem;\n}\n\n.imgWrapper:hover {\n    background-color: white;\n    cursor: pointer;\n}",
      "node": "",
      "text": "undefined",
      "dom": {}
    },
    {
      "name": "login",
      "ux": "#div root\n    -display flex\n    -display flex\n\n    img ctaUser\n        -margin 0px 0px 0px 10px\n        -padding 0px\n        -fontFamily \"Open Sans\", \"Courier New\"\n        -fontSize 12px\n        -color white\n        -borderRadius 50%\n        -width 30px\n        -height 30px\n        .move window   \n        .src \n\n    div mnuUser\n        -display none\n        -border 1px solid black\n        -backgroundColor white\n        -zIndex 1000\n        \n        div\n            -display flex\n            -flexDirection column\n            div\n                -display flex\n                input mail\n                    .type text\n                    .class form-control\n                    .placeholder mail\n\n                input password\n                    .type password\n                    .class form-control\n                    .placeholder password\n\n                button ctaSignin 'Login\n                    .class btn btn-primary\n            div\n                span ctaSignUp 'Sign up\n                    -fontSize 10px\n                    -color blue\n                    -cursor pointer\n\n\n",
      "js": "// **************** MENU USER\nvar isMouseOver = false\nmnuUser.style.display = 'none'\nctaUser.onclick = ev => {\n\n    // Prendo il cookie\n    // Se funzia visualizzo logout altrimenti login mnuGuest\n    if(mnuUser.style.display=='none'){\n\n        var rect = ctaUser.getBoundingClientRect()\n    \n        mnuUser.style.top = rect.bottom +'px'\n        mnuUser.style.left = '0px'\n\n        mnuUser.style.padding = '10px'\n        mnuUser.style.position = 'fixed'\n        mnuUser.style.display = 'flex'\n\n        var rectMnu = mnuUser.getBoundingClientRect()\n        //mnuUser.style.left= rect.right - rectMnu.right + rectMnu.left + 'px'\n        mnuUser.style.left = rect.left;\n    } else {\n        mnuUser.style.display = 'none'\n    }\n}\n\nmail.onclick = ev => {\n    mail.focus()\n}\n\npassword.onclick = ev => {\n    password.focus()\n}\n\n// **********************************************\n\nctaSignin.onclick = ev => {\n    mnuUser.style.display='none'\n    document.postJson(\"login\", {mail: mail.value, pass:password.value}).then(json => {\n        if(json.esito == \"ok\"){\n            document.UI.currentMail = mail.value\n            document.UI.currentPassword = password.value\n            document.em(\"db.isLogged\", true)\n            //if(mail.value == \"xxxxxx\"){document.UI.isKate.proxy.value = true}\n        }\n    })\n    \n}\n\nctaSignUp.onclick = ev => {\n    mnuUser.style.display='none'\n    document.em(\"windowDev.print\", signUp())\n}\n\n\n\ndocument.json(\"getAsset\", {projectUrl:\"index\"}).then(json => {\n    ctaUser.src = json.logo\n})\n\ndocument.register(\"login.showLogin\", ev => {\n    ctaUser.click()\n})",
      "css": "",
      "node": "",
      "text": "undefined"
    },
    {
      "name": "projectExplorer",
      "ux": "#div\n    -height 100%\n    -minWidth 200px\n    div root\n        .class scroll\n        -height 100%\n        -overflow auto\n        -backgroundColor rgb(38,37,38)\n        -cursor pointer\n        div\n            -display flex\n            -justifyContent space-around\n\n        div\n            -display flex\n            -flexDirection column\n            div\n                -display flex\n                -justifyContent space-between\n                span ' EXPLORER   \n                span ctaChangeProject '... \n\n            div\n                -display flex\n                -justifyContent space-around\n                span 'Project 1\n                span ctaNewComponent '+\n",
      "js": "let comps = document.db.Project[document.UI.currentProjectID].Component\n\ncomps.forEach((e,i,a)=>{\n    let p = document.createElement(\"p\")\n    p.innerHTML = '<span class=\"favicon\">j#&gt;</span><span>'+ e.name + '</span>'\n    p.onclick = ev => {\n        p.style.backgroundColor = \"rgb(0,72,117)\"\n        p.style.color = \"white\"\n        document.em(\"tabber.openComponent\",{componentID:i,projectID:document.UI.currentProjectID, layer:\"ux\", type:\"comp\"})\n        document.em(\"windowDev.loadComponent\", {ProjectID: document.UI.currentProjectId, ComponentID: i})\n    }\n\n    p.ondblclick = ev => {\n        let confirmation = confirm('Do you want to delete the file?')\n\n        if(confirmation){\n            p.parentNode.removeChild(p)\n            \n            // Remove da db\n            a.splice(i,1)\n            \n            // Remove da remote\n        }\n        \n        \n        \n\n        \n    }\n    root.append(p)\n})\n\nlet p = Array.from(root.getElementsByTagName(\"p\"))\nconsole.log(p)\n\np.sort((a,b) => (a.innerText > b.innerText) ? 1 : ((b.innerText > a.innerText) ? -1 : 0))\n\np.forEach((e)=>{\n    e.remove()\n    root.append(e)\n})\n\nlet isChangeProjectOpen = false\nlet d = {}\nctaChangeProject.onclick = ev => {    \n    \n    if (!isChangeProjectOpen){\n        d = changeProjectMenu()   \n        var rect = ctaChangeProject.getBoundingClientRect()\n        d.style.display = 'initial'\n        d.style.position = 'fixed'\n        d.style.top = rect.bottom +'px'\n        d.style.left = rect.left + 'px'\n        d.style.padding = '10px'\n    \n        root.append(d)\n        isChangeProjectOpen = true\n    } else {\n        console.log(\"now remove\")\n        d.remove()\n        isChangeProjectOpen = false\n    }\n}\n\n\n//********* NEW COMPONENT\n\nfunction selectElementContents(el) {\n    var range = document.createRange();\n    range.selectNodeContents(el);\n    var sel = window.getSelection();\n    sel.removeAllRanges();\n    sel.addRange(range);\n}\n\n\nfunction enterListener(ev){\n    \n    if(ev.keyCode==13){\n        ev.preventDefault()\n        \n        ev.target.removeEventListener(\"keydown\", enterListener)\n        root.lastChild.lastChild.contentEditable = false\n        document.db.Project[document.UI.currentProjectID].Component[document.UI.currentComponentID].name = root.lastChild.lastChild.innerHTML\n\n        Array.from(root.querySelectorAll(\"p\")).forEach(p=>{\n            p.firstChild.classList.remove(\"faviconBlur\")\n            p.firstChild.classList.add(\"favicon\")\n            p.lastChild.classList.remove(\"fontBlur\")\n        })\n\n        document.em(\"tabber.openComponent\",{componentID:document.UI.currentComponentID,projectID:document.UI.currentProjectID, layer:\"ux\", type:\"comp\"})\n        \n        ev.target.parentNode.onclick = ev => {\n            document.em(\"tabber.openComponent\",{componentID:comps.length-1,projectID:document.UI.currentProjectID, layer:\"ux\", type:\"comp\"})\n        }\n\n        //ev.target.innerHTML = '<span class=\"favicon\">py</span>'+root.lastChild.innerHTML\n    }    \n}\n\nfunction focusLost(ev){\n    if(ev.target.innerHTML == \"\"){\n       ev.target.parentNode.parentNode.removeChild(ev.target.parentNode)\n        //bug - rimuovere ultimo elemento da comps[]\n    } else {\n        ev.target.removeEventListener(\"keydown\", enterListener)\n        root.lastChild.lastChild.contentEditable = false\n        document.db.Project[document.UI.currentProjectID].Component[document.UI.currentComponentID].name = root.lastChild.lastChild.innerHTML\n        document.em(\"tabber.openComponent\",{componentID:document.UI.currentComponentID,projectID:document.UI.currentProjectID, layer:\"ux\", type:\"comp\"})\n\n        ev.target.parentNode.onclick = ev => {\n            document.em(\"tabber.openComponent\",{componentID:comps.length-1,projectID:document.UI.currentProjectID, layer:\"ux\", type:\"comp\"})\n        }\n\n        //ev.target.innerHTML = '<span class=\"favicon\">py</span>'+root.lastChild.innerHTML\n    }\n\n    Array.from(root.querySelectorAll(\"p\")).forEach(p=>{\n        p.firstChild.classList.remove(\"faviconBlur\")\n        p.firstChild.classList.add(\"favicon\")\n        p.lastChild.classList.remove(\"fontBlur\")\n    })\n}\n\nctaNewComponent.onclick = ev => {\n\n    Array.from(root.querySelectorAll(\"p\")).forEach(p=>{\n        p.firstChild.classList.add(\"faviconBlur\")\n        p.firstChild.classList.remove(\"favicon\")    \n        p.lastChild.classList.add(\"fontBlur\")\n    })\n\n\n    // Local array\n    comp = {\n        name: \"\",\n        ux: \"\",\n        js: \"\",\n        css: \"\"\n    }    \n    comps.push(comp)\n    document.UI.currentComponentID = comps.length-1\n\n    let p = document.createElement('p')\n    p.innerHTML = '<span class=\"favicon\">j#></span><span>'+ comp.name + '</span>'\n\n    p.lastChild.contentEditable = true\n    root.append(p)\n    p.lastChild.focus()\n    selectElementContents(p.lastChild)\n    //p.click()\n    \n    p.lastChild.addEventListener(\"keydown\",enterListener)\n    p.lastChild.addEventListener(\"focusout\", focusLost)\n}\n\n\n\n//********* END NEW COMPONENT\n\n",
      "css": "* {\n    color: rgb(204,204,204);\n    background-color: rgb(37,37,38);\n    cursor: pointer;\n}\n\np {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    margin: 0;\n    padding: 0.1rem 1rem 0.1rem 1rem;\n}    \n\np:hover {\n    background-color: rgb(55,55,62)\n}\n\n.favicon {\n    color: yellow;\n    font-size: 8px;\n}\n\n.faviconBlur {\n    color: rgb(90,92,93);\n    font-size: 8px;\n}\n\n.fontBlur {\n    color: rgb(90,92,93);\n}\n\n\n/* SCROLL BAR  */\n\n/* width */\n.scroll::-webkit-scrollbar {\n  width: 13px;\n}\n\n/* Track */\n.scroll::-webkit-scrollbar-track {\n  box-shadow: inset 0 0 5px grey; \n  background-color: rgb(37,37,38)\n}\n \n/* Handle */\n.scroll::-webkit-scrollbar-thumb {\n  background-color: rgb(81,81,81); \n}\n\n/* Handle on hover */\n.scroll::-webkit-scrollbar-thumb:hover {\n  background-color: rgb(81,81,81); \n}",
      "node": "",
      "text": "undefined",
      "dom": {}
    },
    {
      "name": "tabber",
      "ux": "div root\n    -display flex\n    -flexDirection column\n    -overflow auto\n    -width 100%\n    -height 100%\n    div thead\n        .class thead\n\n    div codeAreaWrap\n        .class codeAreaWrap\n        -flexGrow 1\n        -width 100%\n        -height 100%\n        -display flex\n        -backgroundColor black\n        \n        div lines\n            -display flex\n            -flexDirection column\n            span '1\n                -paddingTop 3px\n            span '2\n            span '3\n            span '4\n            span '5\n            span '6\n            span '7\n            span '8\n            span '9\n            span '10\n            span '11\n            span '12\n            span '13\n            span '14\n            span '15\n            span '16\n            span '17\n            span '18\n            span '19\n            span '20\n            span '21\n            span '22\n            span '23\n            span '24\n            span '25\n            span '26\n            span '27\n            span '28\n            span '29\n            span '30\n            span '31\n            span '32\n            span '33\n            span '34\n            span '35\n            span '36\n            span '37\n            span '38\n            span '39  \n            span '40      \n        textarea textareaCode \n            -flexGrow 1\n            -resize none\n            -fontFamily Consolas, \"Courier New\", monospace\n            -fontSize 14px\n            -backgroundColor rgb(30,30,30)\n            -color white \n\n\n    div previewArea\n        .class previewArea\n        -display none\n        -flexGrow 1\n        *cover",
      "js": "document.UI.Tab = []\ndocument.UI.tempTab = {}\ndocument.UI.currentTab = {}\n\nfunction saveCurrentEditor(ev){\n    T.forEach((e,i,a)=>{\n        if(e.isSelected){\n            let ct = document.UI.currentTab\n\n            if(e.activeLayer == \"ux\"){\n                e.component.ux = textareaCode.value\n                return\n            }\n\n            if(e.activeLayer == \"js\"){\n                e.component.js = textareaCode.value\n                return\n            }\n\n            if(e.activeLayer == \"css\"){\n                e.component.css = textareaCode.value\n                return\n            }\n\n            if(e.activeLayer == \"node\" || e.activeLayer == \"python\"){\n                e.component.code = textareaCode.value\n                return\n            }\n\n            if(e.activeLayer == \"markdown\"){\n                e.component.post = textareaCode.value\n                return\n            }\n        }\n    })\n    return\n}\n\ntextareaCode.onkeydown = ev => {\n\n    if(ev.keyCode==83){\n        if(ev.ctrlKey){\n            //Save file or component, for now component\n            T.forEach((e,i,a)=>{\n                if(e.isSelected){\n              \n                    let ct = document.UI.currentTab\n                    if(e.activeLayer == \"ux\"){\n                        e.component.ux = textareaCode.value\n                        return\n                    }\n\n                    if(e.activeLayer == \"js\"){\n                        e.component.js = textareaCode.value\n                        return\n                    }\n\n                    if(e.activeLayer == \"css\"){\n                        e.component.css = textareaCode.value\n                        return\n                    }\n\n                    if(e.activeLayer == \"node\" || e.activeLayer == \"python\"){\n                        e.component.code = textareaCode.value\n                        return\n                    }\n\n                    if(e.activeLayer == \"markdown\"){\n                        e.component.post = textareaCode.value\n                        return\n                    }\n\n                }\n            })\n            return\n        }\n    }\n\n    if(ev.keyCode == 9){\n        ev.preventDefault()\n        //prendo il caret e aggiungo quattro spazi\n        const caretPos = textareaCode.selectionStart\n        const startCode1 = 0\n        const strFirstLen = textareaCode.value.substr(0, caretPos)\n        const strLen = textareaCode.value\n        const strSecondLen = strLen.length-strFirstLen.length\n        textareaCode.value = textareaCode.value.substr(0, caretPos) + \"    \" + textareaCode.value.substr(caretPos, strSecondLen)\n        textareaCode.selectionEnd = caretPos + 4\n    }\n\n}\n\n\n\n\nfunction createTabDiv(name){\n    let div = document.createElement(\"div\")\n    div.classList.add(\"titleItem\")\n    let sp1 = document.createElement(\"span\")\n    let sp2 = document.createElement(\"span\")\n    let sp3 = document.createElement(\"span\")\n\n    \n    sp1.classList.add(\"favicon\")\n    sp3.classList.add(\"close\")\n    \n\n    sp1.innerHTML = \"<>\"\n    sp1.onclick = ev => {\n        saveCurrentEditor()\n        let ct = document.UI.currentTab\n        if(ct.activeLayer == \"ux\"){\n            sp1.innerHTML = \"JS\"\n            textareaCode.value = document.UI.currentTab.component.js\n            ct.activeLayer = \"js\"\n            return\n        }\n\n        if(ct.activeLayer == \"js\"){\n            sp1.innerHTML = \"#\"\n            textareaCode.value = document.UI.currentTab.component.css\n            ct.activeLayer = \"css\"\n            return\n        }\n\n        if(ct.activeLayer == \"css\"){\n            sp1.innerHTML = \"<>\"\n            textareaCode.value = document.UI.currentTab.component.ux\n            ct.activeLayer = \"ux\"\n            return\n        }\n\n    }\n    \n    sp2.innerHTML = name\n    sp3.innerHTML = \"x\"\n    sp3.style.cursor = \"pointer\"\n    sp3.onclick = ev => {\n        saveCurrentEditor()\n\n        document.UI.Tab.forEach((e,i,a)=>{\n            if(e.dom === div){\n                document.UI.Tab.splice(i,1)\n            }\n        })\n\n        \n\n        div.style.display = \"none\"\n        let nearest = document.UI.Tab[0]\n        \n        document.UI.currentTab = nearest\n\n        if(nearest != undefined){\n            document.UI.currentTab.isSelected = true  \n            switchSelectedTab(nearest.projectID, nearest.componentID, nearest.activeLayer)      \n        } else {\n            textareaCode.value = \"\"\n        }\n        \n        \n        \n    }\n\n\n    div.append(sp1, sp2, sp3)\n\n    sp2.onclick = ev => {\n        saveCurrentEditor()\n        T.forEach((e,i,a)=>{\n            if(e.dom === div){\n                if(e.type==\"comp\"){\n                    document.em(\"currentComponentID\", e.componentID)\n                    document.em('windowDev.loadComponent',{ProjectID:e.projectID,ComponentID:e.componentID})\n                } else {\n                    if(e.activeLayer==\"markdown\"){\n                        document.UI.currentPostID = e.componentID // Here born this data!!!!\n                    } else {\n                        document.UI.currentServiceID = e.componentID\n                    }\n                    \n                }\n\n                switchSelectedTab(e.projectID, e.componentID, e.activeLayer)\n            }\n        })\n    }\n    \n    return div\n}\n\nfunction switchSelectedTab(projectID, componentID, layer){\n    T.forEach((e,i,a)=>{\n        if(e.projectID==projectID && e.componentID==componentID && e.activeLayer==layer){\n            e.isSelected = true\n            e.dom.classList.add(\"selected\")\n            e.dom.classList.remove(\"nonSelected\")\n            e.dom.lastChild.classList.add(\"closeSelected\")\n            e.dom.lastChild.classList.remove(\"close\")\n            document.UI.currentTab = e\n\n            switch(e.activeLayer){\n                case \"ux\":\n                    textareaCode.value = e.component.ux\n                    break\n\n                case \"js\":\n                    textareaCode.value = e.component.js\n                    break\n\n                case \"css\":\n                    textareaCode.value = e.component.css\n                    break\n                \n                case \"node\":\n                    textareaCode.value = e.component.code\n                    break\n\n                case \"python\":\n                    textareaCode.value = e.component.code\n                    break\n                case \"markdown\":\n                    textareaCode.value = e.component.post\n                    break\n            }\n\n\n        } else {\n            e.isSelected = false\n            e.dom.classList.remove(\"selected\")\n            e.dom.classList.add(\"nonSelected\")\n            //e.dom.lastChild.classList.remove(\"closeSelected\")\n            //e.dom.lastChild.classList.add(\"close\")\n        }\n    })\n}\n\n//let s = {\n//    projectID: 0,\n//    componentID: 0,\n//    type: \"comp\",\n//    activeLayer: \"ux\",\n//    isSelected: true,\n//    fileName: \"component.ux\",\n//    component: {\n//       name: \"component\",\n//        ux: \"div root\"\n//    },\n//    dom: document.createElement(\"div\")\n//}\n\n\nlet T = document.UI.Tab\n\n//T.push(s)\n\n\ndocument.register(\"tabber.openComponent\", (ev)=> {\n    saveCurrentEditor()\n    let p = ev.detail.projectID\n    let c = ev.detail.componentID\n    let layer = ev.detail.layer //layers: ux, js, css, node, python, ruby, markdown\n    let type = ev.detail.type ? ev.detail.type : \"comp\" // types: comp, file\n    \n\n    // check if it is open\n    let isOpen = -1\n    T.forEach( (e,i,a)=>{\n        if(e.projectID==p && e.componentID==c && e.activeLayer==layer){\n            // Already open\n            isOpen = i\n        }\n    })\n\n    if(isOpen!=-1){\n        \n        T[isOpen].dom.classList.add(\"selected\")\n        T[isOpen].isSelected = true\n        if(type==\"comp\"){\n            textareaCode.value = T[isOpen].component.ux\n        } else {\n            if(layer==\"markdown\"){\n                textareaCode.value = T[isOpen].component.post\n            } else {\n                textareaCode.value = T[isOpen].component.code  \n            }\n                \n        }\n        document.UI.currentTab = T[isOpen]\n\n\n        \n    } else { \n        let comp = {}\n        if(type==\"comp\") {        \n            comp = document.db.Project[p].Component[c]\n        }\n        if(layer==\"node\" || layer==\"python\" || layer==\"go\" || layer==\"ruby\"){\n            comp = document.db.Project[p].Service[c]\n        }\n        if(layer==\"markdown\"){\n            comp = document.db.Project[p].Data.Post[c]\n        }\n\n        \n        let dom = createTabDiv(comp.name)\n     \n        let n = {\n            projectID: p,\n            componentID: c,\n            type: type,  //file, comp\n            activeLayer: layer, // ux, js, css, node, python, ruby, go, markdown\n            isSelected: true,\n            component: comp,\n            dom: dom\n        }\n        T.push(n)\n        thead.append(n.dom)\n        if(type==\"comp\"){\n            textareaCode.value = comp.ux\n        } else {\n            if(layer==\"markdown\"){\n                textareaCode.value = comp.post\n            } else {\n                textareaCode.value = comp.code\n            } \n            \n        }\n        document.UI.currentTab = n\n    }\n    \n    if(type==\"comp\"){\n        document.em(\"currentComponentID\", c)\n        document.em('windowDev.loadComponent',{ProjectID:p,ComponentID:c})\n        switchSelectedTab(p,c, layer)\n    } else {\n        document.UI.currentServiceID = c\n        switchSelectedTab(p, c, layer)\n    }\n    \n})\n\n\ndocument.register(\"tabber.saveCurrentEditor\", saveCurrentEditor)\n\ndocument.register(\"tabber.closePreview\", ev => {\n    previewArea.style.display = \"none\"\n    codeAreaWrap.style.display = \"flex\"\n    //textareaCode.style.display = \"initial\"\n    thead.style.display = \"flex\"\n})\n\n\ndocument.register(\"tabber.preview\", ev => {\n    //saveCurrentEditor()\n\n    codeAreaWrap.style.display = \"none\"\n    previewArea.style.display = 'flex'\n\n    let ct = document.UI.currentTab\n\n    switch(ct.activeLayer){\n        case \"markdown\":\n            saveCurrentEditor()\n\n            codeAreaWrap.style.display = \"none\"\n            previewArea.style.display = 'flex'\n\n            \n\n            function getPost(title) {\n                let posts = document.db.Project[document.UI.currentProjectID].Data.Post\n                let postDiv = document.createElement('div')\n                posts.forEach( (e, i, a) => {\n                    if(e.title == title){\n                        let md = window.markdownit()  \n                        postDiv.innerHTML = md.render(e.post)\n                    }\n                })\n            }\n   \n            previewArea.innerHTML = ''\n    \n            let postDiv = document.createElement('div')\n            let md = window.markdownit()  \n            postDiv.innerHTML = md.render(document.db.Project[ct.projectID].Data.Post[ct.componentID].post)\n            previewArea.append(viewPost(postDiv))\n       \n            thead.style.display = \"none\"  \n            \n            break;\n\n        case \"ux\":\n        case \"js\":\n        case \"css\":\n            saveCurrentEditor()\n            let code = ux.parserJSFunction(ct.component.name, ct.component.ux, ct.component.js, ct.component.css)\n\n            let firstRow = ct.component.js.split('\\n')[0]\n            let jsStart = 0\n            code.split('\\n').forEach((e,i,a)=>{\n                if(firstRow==e){\n                    jsStart = i\n                    // break\n                }\n            })\n\n\n            //code = code.replace(\"{\",`{ try {`)\n            //code =  code + \"catch(err){console.log(err.stack)}}\"\n  \n\n    \n            let scriptTag = document.getElementById(ct.component.name)\n            if(scriptTag !== null){\n                scriptTag.parentNode.removeChild(scriptTag)\n            } \n\n\n            function onErrorHandler(ev){\n                console.log(\"onErrorHandler\")\n                let effectiveLine = ev.lineno - jsStart\n                console.log(\"effective line is = \" + effectiveLine)\n\n                lines.children.item(effectiveLine-1).style.backgroundColor = 'red'\n                lines.children.item(effectiveLine-1).title = ev.message\n\n                document.em(\"tabber.closePreview\")\n            }\n\n            window.addEventListener(\"error\", onErrorHandler)\n\n            scriptTag = document.createElement('script')\n            scriptTag.setAttribute('id', ct.component.name)\n            scriptTag.append(document.createTextNode(code))\n            document.body.append(scriptTag)\n   \n            previewArea.innerHTML = ''\n            let previewDom = window[ct.component.name]()\n            previewArea.append(previewDom)\n\n            document.db.Project[document.UI.currentProjectID].Component[document.UI.currentComponentID].dom = previewDom\n   \n            thead.style.display = \"none\"\n    \n            window.removeEventListener(\"error\", onErrorHandler)            \n            \n            break;\n    }\n\n})\n\ndocument.register(\"tabber.previewMarkdown\", ev => {\n    //saveCurrentEditor()\n\n    codeAreaWrap.style.display = \"none\"\n    previewArea.style.display = 'flex'\n\n    let ct = document.UI.currentTab  \n\n    function getPost(title) {\n        let posts = document.db.Project[document.UI.currentProjectID].Data.Post\n        let postDiv = document.createElement('div')\n        posts.forEach( (e, i, a) => {\n            if(e.title == title){\n                let md = window.markdownit()  \n                postDiv.innerHTML = md.render(e.post)\n            }\n        })\n    }\n   \n    previewArea.innerHTML = ''\n    \n    previewArea.append(viewPost(getPost(\"UX\")))\n       \n    thead.style.display = \"none\"  \n})\n\ndocument.register(\"tabber.print\", ev => {\n    saveCurrentEditor()\n    codeAreaWrap.style.display = \"none\"\n    previewArea.style.display = 'flex'\n    previewArea.innerHTML = ''\n    previewArea.append(ev.detail)\n})\n\n\ndocument.register(\"tabber.mongoBrowser\", ev => {\n    saveCurrentEditor()\n    codeAreaWrap.style.display = \"none\"\n    previewArea.style.display = 'flex'\n    previewArea.innerHTML = ''\n    previewArea.append(mongoBrowser(ev.detail.collection))    \n})\n\n\n\n",
      "css": "/*\n* {\n    color: white;\n}\n*/\n\n.tabTitle {\n    display: flex;\n    padding: 0.5rem;\n    color: white;\n}\n\n.close {\n    color: #003a66;\n}\n\n.close:hover {\n    color: white;\n    cursor: pointer;\n}\n\n.favicon {\n    color: yellow;\n    cursor: pointer;\n}\n\n.more {\n    color: red;\n    cursor: pointer;\n}\n\n.selected {\n    background-color: black;\n}\n\n.nonSelected {\n    background-color: rgb(45,45,45)\n}\n\n.thead {\n    display: flex;\n    background-color: rgb(37,37,38);\n}\n\n.titleItem {\n    display: flex;\n    gap: 1rem;\n    justify-content: space-around;\n    padding: 0.5rem;\n    color: white;\n    \n}\n\n.previewArea * {\n    color: black;\n}\n\n.codeAreaWrap > div > span {\n    color: white;\n    font-family: \"Courier New\", Consolas, monospace;\n    font-size: 14px;\n    margin: 0;\n    padding: -1px;\n    line-height: 1.15;\n}",
      "node": "",
      "text": "undefined",
      "dom": {}
    },
        {
      "name": "cover",
      "ux": "#div root\n    -display flex\n    -flexDirection column\n    -width 100%\n    -height 100%\n    -justifyContent center\n    -alignItems center\n    -backgroundColor #726E6D\n    h1 'Kate Code It!\n        -flexGrow 1\n    div\n        -flexGrow 2\n        p 'Create html, css and js components.\n        div\n            -display flex\n            -justifyContent space-around\n            button ctaLearn 'Learn\n            button 'New Project",
      "js": "ctaLearn.onclick = ev => {\n    document.em(\"windowDev.print\", help())\n}",
      "css": "* {\n    color: white;\n}\n\nbutton {\n    color: blue;\n    padding: 1rem;\n    border-radius: 1rem;\n    cursor: pointer;\n}",
      "node": "",
      "text": "undefined"
    },
        {
      "name": "toast",
      "ux": "div root\n    -position fixed\n    -right 30px\n    -bottom 30px\n    -zIndex 1000\n    -border solid 3px blue\n    -backgroundColor green\n    -cursor pointer\n\n    div msg",
      "js": "function wait(ms){\n   var start = new Date().getTime();\n   var end = start;\n   while(end < start + ms) {\n     end = new Date().getTime();\n  }\n}\n\ndocument.register(\"toast\", ev => {\n    root.style.display = \"fixed\"\n    msg.innerHTML = ''\n    msg.textContent = ev.detail\n    //wait(1000)\n    //document.body.removeChild(root)\n})\n\n\nroot.onclick = ev => {\n    root.style.display = \"none\"\n}\n\n\n",
      "css": "",
      "node": "",
      "text": "undefined"
    },
        {
      "name": "viewProjects",
      "ux": "div root",
      "js": "function viewProjects() {\n    var prj = document.db.Project\n\n    var div = document.createElement('div')\n    prj.forEach( (e,i,a) => {\n        var b = document.createElement('button')\n        b.innerHTML = e.name\n        b.onclick = ev => {\n            //document.UI.currentProjectID = i\n            document.em(\"currentProjectID\", i)\n            //document.UI.currentComponentID = 0\n            document.em(\"currentComponentID\", 0)\n            document.em('windowDev.loadComponent', {ProjectID:i,ComponentID:0})\n            document.em(\"viewComponents.open\")\n        }\n        div.appendChild(b)\n    });\n\n    document.em('windowDev.print',div)  \n\n}\n\ndocument.register(\"viewProjects.open\", viewProjects)",
      "css": "",
      "text": "undefined"
    },

    {
      "name": "viewComponents",
      "ux": "div root\n    -marginLeft 25%\n    -marginRight 25%\n    -marginTop 50px\n    -display none\n    LINK\n    .rel stylesheet\n    .href https://unpkg.com/purecss@2.1.0/build/pure-min.css\n    .integrity sha384-yHIFVG6ClnONEA5yB5DJXfW2/KC173DIQrYoZMEtBvGzmf0PKiGyNEqe9N6BNDBH\n    .crossOrigin anonymous\n\n    table\n        thead\n            tr\n                td '#\n                td 'Component Name\n        tbody tbody\n            ",
      "js": "function viewComponents2() {\n    tbody.innerHTML = \"\"\n    var comps = document.db.Project[document.UI.currentProjectID].Component\n    //comps.sort((a,b) => (a.name > b.name) ? 1 : ((b.name > a.name) ? -1 : 0))\n    comps.forEach( (e,i,a) => {\n        let tr = document.createElement('tr')\n        let td1 = document.createElement('td')\n        let td2 = document.createElement('td')\n    \n        td1.innerHTML = i\n        td2.innerHTML = e.name\n\n        tr.append(td1,td2)\n\n        tr.onclick = ev => {\n            document.em(\"currentComponentID\", i)\n            document.em('windowDev.loadComponent',{ProjectID:document.UI.currentProjectID,ComponentID:i})\n        }\n\n        tbody.append(tr)\n    })\n    root.style.display = 'flex'\n    document.em('windowDev.print',root) \n}\n\n\nfunction viewComponents(){\n    var comps = document.db.Project[document.UI.currentProjectID].Component\n\n    var div = document.createElement('div')\n    comps.forEach( (e,i,a) => {\n        var b = document.createElement('button')\n        b.innerHTML = e.name\n        b.onclick = ev => {\n            //document.UI.currentComponentID = i\n            document.em(\"currentComponentID\", i)\n            document.em('windowDev.loadComponent',{ProjectID:document.UI.currentProjectID,ComponentID:i})\n        }\n        div.appendChild(b)\n    });\n    \n    document.em('windowDev.print',div)  \n}\n\ndocument.register(\"viewComponents.open\", viewComponents2)",
      "css": "tbody tr:hover {\n    cursor: pointer;\n    color: white;\n    background: radial-gradient(circle, rgba(35,38,39,0.9982274159663865) 100%, rgba(235,235,235,1) 100%, rgba(86,110,159,1) 100%);\n}",
      "text": "undefined"
    }
    ]
}]
}

</div>
<script id="ux-assets-js">var ux = function() {
  "use strict";
  /*
        RESTITUISCE UNA FUNZIONE JS
    */  function getTokenType(t) {
    // t = string
    const sentinel = t.substr(0, 1);
    if (sentinel == ".") return "attr";
    if (sentinel == "-") return "style";
    if (sentinel == "'") return "text";
    if (sentinel == "\\") return "include";
    if (sentinel == "<") return "html";
    if (sentinel == "#") return "shadow";
    return "elem";
  }
  function isImport(t) {
    const sentinel = t.substr(0, 1);
    if (sentinel == "*") return true; else return false;
  }
  function countTabs(l) {
    const count = Math.floor(l.search(/\S|$/) / 4);
    return count;
  }
  function writeAttribute(tokens, arrOut, currentVarName, namespace) {
    var value = tokens[1];
    tokens.slice(2).forEach((v => {
      value = value + " " + v;
    }));
    if (tokens[0].substr(1, 2) == "on") {
      arrOut.push(`${currentVarName}${tokens[0]} = ${value}`);
    } else {
      arrOut.push(`${currentVarName}.setAttribute('${tokens[0].slice(1)}', '${value}')`);
    }
  }
  function writeText(tokens, arrOut, currentVarName, n) {
    //# t = tokens    f = fileOut   c = currentVarName    n = count
    // TRASFORMARE QUESTO CASO IN NODE ELEMENT!!!
    var value = tokens[0].slice(1);
 // considero la stringa senza '
        tokens.slice(1).forEach((v => {
      value = value + " " + v;
    }));
    arrOut.push(`var textNode_${n} = document.createTextNode('${value}')`);
    arrOut.push(`${currentVarName}.append(textNode_${n})`);
  }
  function writeStyle(tokens, arrOut, currentVarName) {
    var value = tokens[1];
    tokens.slice(2).forEach((v => {
      value = value + " " + v;
    }));
    arrOut.push(`${currentVarName}.style${tokens[0].replace("-", ".")}='${value}'`);
  }
  var parserJSFunction = function parse(fileName, textCode, scriptCode = "", cssCode = "") {
    const ns = {
      div: 0,
      svg: 1,
      circle: 1,
      rect: 1,
      path: 1,
      polygon: 1,
      polyline: 1,
      text: 1,
      g: 1
    };
    const nsName = {
      0: "",
      1: "http://www.w3.org/2000/svg"
    };
    var importArr = [];
    var codeArr = [];
    var Lines = textCode.split("\n");
    var count = 0;
    var currentVarName = "";
    var varName = "";
    var currentNS = "0";
    var appends = [];
    var currTabNum = 0;
    var prevTabNum = 0;
    var isFirstElement = true;
    var isShadow = false;
    var firstElement = "";
    Lines.forEach(((v, i, a) => {
      var tokens = v.trim().split(" ");
      if (tokens.length == 0 || tokens[0] == "") {
        return;
      }
      var leadToken = tokens[0];
      var tokenType = getTokenType(leadToken);
      currTabNum = countTabs(v);
      if (tokenType == "elem" || tokenType == "shadow") {
        if (tokenType == "shadow") {
          isShadow = true;
          leadToken = leadToken.slice(1);
          tokens[0] = tokens[0].slice(1);
          //console.log(`isShadow ${leadToken}`)
                }
        if (tokens.length == 1) {
          if (isImport(leadToken)) {
            varName = leadToken.slice(1) + "_" + count;
          } else {
            varName = leadToken + "_" + count;
          }
        } else if (tokens.length == 2 && getTokenType(tokens[1]) == "elem") {
          varName = tokens[1];
        } else if (tokens.length == 2 && getTokenType(tokens[1]) == "text") {
          if (isImport(leadToken)) {
            varName = leadToken.slice(1) + "_" + count;
          } else {
            varName = leadToken + "_" + count;
          }
        } else if (tokens.length >= 3 && getTokenType(tokens[1]) == "elem") {
          varName = tokens[1];
        } else if (tokens.length >= 3 && getTokenType(tokens[1]) == "text") {
          if (isImport(leadToken)) {
            varName = leadToken.slice(1) + "_" + count;
          } else {
            varName = leadToken + "_" + count;
          }
        }
        /*             } else if (tokens.length>=3 && getTokenType(tokens[1]=='text')) {
                    if(isImport(leadToken)){
                        varName = leadToken.slice(1) + "_" + count
                    } else {
                        varName = leadToken + "_" + count
                    }
                } else if (tokens.length==2 && getTokenType(tokens[1]!='text')) {
                    varName = tokens[1]
                } else {
                    varName = tokens[2]
                } */        if (isFirstElement) {
          isFirstElement = false;
          firstElement = varName;
          // SCRIVO LE COSE DI APERTURA
                    codeArr.push(`function ${fileName}() `);
 //export default function
                    codeArr.push("{");
        }
        currentVarName = varName;
        currentNS = ns[tokens[0]];
        if (isImport(leadToken)) {
          //importArr.push(`import ${varName}_ from './${leadToken.slice(1)}.js'`)
          //codeArr.push(`var ${varName} = ${varName}_()`)  
          codeArr.push(`var ${varName} = ${leadToken.slice(1)}()`);
        } else {
          if (currentNS == 0 || currentNS === undefined) {
            codeArr.push(`var ${varName} = document.createElement('${tokens[0]}')`);
            if (tokens.length == 2 && getTokenType(tokens[1]) == "text") {
              var valueString = "";
              tokens.slice(1).forEach((v => {
                valueString = valueString + " " + v;
              }));
              codeArr.push(`${varName}.append(document.createTextNode(${valueString}'))`);
            } else if (tokens.length > 2 && getTokenType(tokens[1]) == "text") {
              var valueString = "";
              tokens.slice(1).forEach((v => {
                valueString = valueString + " " + v;
              }));
              codeArr.push(`${varName}.append(document.createTextNode(${valueString}'))`);
            } else if (tokens.length > 2 && getTokenType(tokens[2]) == "text") {
              var valueString = "";
              tokens.slice(2).forEach((v => {
                valueString = valueString + " " + v;
              }));
              codeArr.push(`${varName}.append(document.createTextNode(${valueString}'))`);
            }
          } else {
            codeArr.push(`var ${varName} = document.createElementNS('${nsName[currentNS]}','${tokens[0]}')`);
            if (tokens.length == 2 && getTokenType(tokens[1]) == "text" || tokens.length == 3) {
              codeArr.push(`${varName}.append(document.createTextNode(${tokens[1]}'))`);
            }
          }
        }
        // APPENDS
                if (prevTabNum > currTabNum) {
          // SVUOTO LIVELLO
          const diff = prevTabNum - currTabNum;
          for (var i = 0; i < diff; i++) {
            appends[appends.length - 1].forEach(((v, i, a) => {
              const prevLiv = appends[appends.length - 2];
              var varEl = prevLiv[prevLiv.length - 1];
              codeArr.push("");
              codeArr.push(`${varEl}.appendChild(${v})`);
              codeArr.push("");
            }));
            appends.splice(appends.length - 1, 1);
          }
        }
        if (currTabNum > appends.length - 1) appends.push([]);
        appends[currTabNum].push(`${varName}`);
      }
      if (tokenType == "attr") writeAttribute(tokens, codeArr, currentVarName);
      if (tokenType == "text") writeText(tokens, codeArr, currentVarName, count);
      if (tokenType == "style") writeStyle(tokens, codeArr, currentVarName);
      if (tokenType == "html") codeArr.push(v);
      prevTabNum = currTabNum;
      count = count + 1;
    }));
    // SVUOTO FINAL
        while (appends.length > 1) {
      appends[appends.length - 1].forEach(((v, i, a) => {
        const prevLiv = appends[appends.length - 2];
        var varEl = prevLiv[prevLiv.length - 1];
        codeArr.push("");
        codeArr.push(`${varEl}.appendChild(${v})`);
        codeArr.push("");
      }));
      appends.splice(appends.length - 1, 1);
    }
    // AGGIUNGO FILE(S) ESTERNI
    //codeArr.push('\n')
        var scriptLines = scriptCode.split("\n");
    scriptLines.forEach((v => {
      var temp = v.trim();
      temp = temp.split(" ");
      if (temp[0] == "import") {
        importArr.push(v);
      } else {
        codeArr.push(v);
      }
    }));
    // AGGIUNGO IL CSS CODE
    // var cssLines = cssCode.split('\n')
    // cssLines.forEach(v => {
    //     var temp = v.trim()
    //     temp = temp.split(' ')
    //     if(temp[0]=='import'){
    //         importArr.push(v)
    //     }else {
    //         codeArr.push(v)
    //     }
    // })
    // SCRIVO LE COSE DI CHIUSURA
        codeArr.push(`${firstElement}.setAttribute('ux-comp-name','${fileName}')`);
    codeArr.push(`let style = document.createElement('style')`);
    codeArr.push(`style.setAttribute('ux-comp-name-css','${fileName}')`);
    codeArr.push("style.textContent = `" + cssCode + "`");
    if (isShadow) {
      codeArr.push(`${firstElement}.attachShadow({mode:'open'})`);
      codeArr.push(`Array.from(${firstElement}.childNodes).forEach((e)=>{${firstElement}.shadowRoot.appendChild(e)});`);
      codeArr.push(`${firstElement}.shadowRoot.appendChild(style)`);
    } else {
      codeArr.push(`${firstElement}.appendChild(style)`);
    }
    codeArr.push(`return ${firstElement}`);
    codeArr.push("}");
    // SALVO STAMPA... FINITO
        var outCode = "";
    importArr.forEach((v => {
      outCode += v + "\n";
    }));
    codeArr.forEach((v => {
      outCode += v + "\n";
    }));
    return outCode;
  };
  var uxLang = {
    parserJSFunction: parserJSFunction
  };
  return uxLang;
}();
</script>
<style id="ux-assets-css"></style>
<script id="ux-gen-code"></script>
</body></html>